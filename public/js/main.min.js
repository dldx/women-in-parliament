"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}function colorParty(t){return void 0!==colors[t]?colors[t]:colors.Other}function genColor(){var t=[];nextCol<16777215&&(t.push(255&nextCol),t.push((65280&nextCol)>>8),t.push((16711680&nextCol)>>16),nextCol+=1);return"rgb("+t.join(",")+")"}function hexToRGBA(t,e){var a=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16);return e?"rgba("+a+", "+n+", "+o+", "+e+")":"rgb("+a+", "+n+", "+o+")"}function formatDate(t){var e=t.getMonth(),a=t.getFullYear();return["Jan","Feb","March","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][e]+" "+a}function reset_zoom(t,e){canvas.transition().duration(500).call(zoom.transform,d3.zoomIdentity).on("end",function(){mouseover_svg.select("#zoomed-area").attr("transform",null),zoomedArea.attr("transform",null),zoom.on("zoom",null),canvas.on("wheel.zoom",null).on("wheel.zoom",null).on("mousedown.zoom",null).on("dblclick.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom touchcancel.zoom",null),canvas.style("pointer-events","auto").style("touch-action","auto"),gY=d3.select(".y-axis").call(yAxis),void 0!==t&&t(e)}),d3.select(".switch").select("label").text("ZOOM")}function update_state(){current_slide!=new_slide&&(1==new_slide?reset_zoom(to_second_slide,current_slide):2==new_slide?reset_zoom(to_third_slide,current_slide):3==new_slide?reset_zoom(to_fourth_slide,current_slide):4==new_slide?(zoom.on("zoom",zoomed),to_fifth_slide(current_slide)):5==new_slide?reset_zoom(to_sixth_slide,current_slide):6==new_slide?reset_zoom(to_seventh_slide,current_slide):-1!=current_slide&0==new_slide&&(zoom.on("zoom",zoomed),to_first_slide(current_slide)),current_slide=new_slide)}function initial_render(){x=d3.scaleUtc().domain([new Date(1915,1,1),new Date(2020,1,1)]).range([0,width]),y=d3.scaleLinear().domain([0,220]).range([height,0]),svg.append("defs"),wrapper=svg.append("g").attr("class","timeline-wrapper").attr("transform","translate("+margin.left+","+margin.top+")"),mouseover_svg.append("g").attr("class","timeline-wrapper").attr("transform","translate("+margin.left+","+margin.top+")"),d3.select("#tooltip").remove(),d3.select("body").append("div").attr("id","tooltip").attr("class","tooltip"),tooltip=document.getElementById("tooltip"),d3.select("body").append("label").attr("class","switch").style("transform","translate("+margin.left*(isMobile?1.2:2)+"px, "+(isMobile?.15*height:margin.top/2)+"px)").html('<input type="checkbox" id="zoom-checkbox"><span class="slider"></span><div><label for=\'zoom-checkbox\'>ZOOM</label></div>'),wrapper.append("rect").style("opacity",0).attr("width",width).attr("height",height),clippedArea=wrapper.append("g").attr("id","clippedArea").attr("clip-path","url(#clip)"),mouseover_svg.select(".timeline-wrapper").append("g").attr("id","clippedArea").attr("clip-path","url(#clip)"),zoomedArea=clippedArea.append("g").attr("id","zoomed-area"),mouseover_svg.select("#clippedArea").append("g").attr("id","zoomed-area"),wrapper.append("clipPath").attr("id","clip").append("rect").attr("width",width).attr("height",height),mouseover_svg.select(".timeline-wrapper").append("clipPath").attr("id","clip").append("rect").attr("width",width).attr("height",height),xAxis=d3.axisBottom(x),isMobile&&xAxis.ticks(5),gX=wrapper.append("g").attr("class","x-axis").attr("transform","translate(0,"+height+")").call(xAxis),yAxis=d3.axisRight(y),gY=wrapper.append("g").attr("class","y-axis").call(yAxis).attr("transform","translate("+width+", 0)"),chartTitle=svg.append("text").attr("x",(isMobile?0:width/2)+margin.left).attr("y",margin.top/2).style("text-anchor",isMobile?"start":"middle").attr("class","chart-title").text(""),(credit_alink=svg.append("a").attr("target","_blank")).append("text").attr("transform","translate("+margin.left+" ,"+(height+margin.top+margin.bottom)+")").attr("class","credit-label").style("text-anchor","start"),xLabel=svg.append("text").attr("transform","translate("+(margin.left+margin.right+width)/2+" ,"+(height+margin.top+margin.bottom)+")").attr("class","x-label").style("text-anchor","middle").text(""),yLabel=svg.append("text").attr("transform","rotate(-90)").attr("y",width+margin.left+3*margin.right/4).attr("x",0-(height+margin.top+margin.bottom)/2).attr("class","y-label").attr("dominant-baseline","hanging").text("Number of Women MPs"),zoom=d3.zoom().scaleExtent([.95,40]).on("zoom",zoomed),d3.select(".scroll__text").style("opacity",1)}function zoomed(t){transform=t||d3.event.transform,0!=current_slide&&4!=current_slide&&5!=current_slide||(zoomedArea.attr("transform",transform),mouseover_svg.select("#zoomed-area").attr("transform",transform)),context.save(),context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),context.translate(transform.x,transform.y),context.scale(transform.k,transform.k),draw(context,!1),context.restore(),context_hidden.save(),context_hidden.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),context_hidden.translate(transform.x,transform.y),context_hidden.scale(transform.k,transform.k),draw(context_hidden,!0),context_hidden.restore(),0==current_slide|1==current_slide?gX.call(xAxis.scale(d3.event.transform.rescaleX(x)).ticks(isMobile?4:8)):4==current_slide?(gX.call(d3.axisBottom(d3.event.transform.rescaleX(slide5_xScale)).ticks(isMobile?5:20)),draw_custom_labels()):d3.event.transform.rescaleX(x),0==current_slide|1==current_slide?gY.call(yAxis.scale(d3.event.transform.rescaleY(y))):d3.event.transform.rescaleY(y)}function add_election_rects(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];d3.select("#election-rects").remove(),electionRects=zoomedArea.append("g").attr("id","election-rects").selectAll("rect").data(total_mps_over_time_data).enter().append("rect").style("opacity",t?.35:0).attr("class","election-rect").classed("c-1",function(t,e){return e%2==0}).classed("c-2",function(t,e){return e%2==1}).attr("x",function(t){return x(t.year)}).attr("y",y(800)).attr("width",function(t,e){var a=t.year,n=total_mps_over_time_data[Math.min(total_mps_over_time_data.length-1,e+1)].year;return x(n)-x(a)}).attr("height",y(0)-y(2e3))}function first_slide(){function t(){var t=d3.mouse(this);context_hidden.save();var e=context_hidden.getImageData(t[0]*ratio,t[1]*ratio,1,1).data;context_hidden.restore();var a="rgb("+e[0]+","+e[1]+","+e[2]+")",n=colourToNode[a];if(void 0!==n){if(Math.abs(y(n.stream)-(t[1]-margin.top))>2&&Math.abs(y(n.stream)-(t[1]-margin.top-transform.y)/transform.k)>2)return;if(-1==mp_filter.indexOf(n.clean_name))return;show_mp_tooltip(n,t)}d3.event.preventDefault()}var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];d3.select("#slide1-group").remove(),d3.select("#election-rects").remove(),chartTitle.transition().text("Women MPs in the House of Commons"),credit_alink.attr("xlink:href",null).select("text").transition().text("Data: House of Commons Library, MySociety"),add_election_rects(e),pointsGroup=zoomedArea.append("g").attr("id","slide1-group"),(instance=dataContainer.selectAll("custom.line").data(mps_over_time_data)).attr("x2",function(t){return x(t.term_end)-1.2*lineThickness}),mouseover_svg.select("#zoomed-area").selectAll("*").remove(),mouseover_svg.select("#zoomed-area").append("line"),0==e?instance.enter().append("custom").attr("class","line").attr("x1",function(t){return x(t.term_start)}).attr("x2",function(t){return x(t.term_start)}).attr("y1",y(0)).attr("y2",y(0)).attr("strokeStyle",function(t){return colorParty(t.party)}).attr("hiddenStrokeStyle",function(t){return t.hiddenCol||(t.hiddenCol=genColor(),colourToNode[t.hiddenCol]=t),t.hiddenCol}):dataContainer.selectAll("custom.line").attr("x1",function(t){return x(t.term_start)}).attr("y1",function(t){return y(t.stream)}).attr("y2",function(t){return y(t.stream)}).attr("x2",function(t){return x(t.term_end)-1.2*lineThickness}),0==e&&(context.scale(ratio,ratio),context.translate(margin.left,margin.top),context.rect(0,0,width,height),context.clip(),context_hidden.scale(ratio,ratio),context_hidden.translate(margin.left,margin.top),context_hidden.rect(0,0,width,height),context_hidden.clip()),window.draw=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),dataContainer.selectAll("custom.line").each(function(){var a=d3.select(this);t.beginPath(),t.lineWidth=e?1.3*lineThickness:lineThickness,t.strokeStyle=e?a.attr("hiddenStrokeStyle"):a.attr("strokeStyle"),e?(t.moveTo(a.attr("x1")-circleRadius,a.attr("y1")),t.lineTo(+a.attr("x2")+circleRadius,a.attr("y2"))):(t.lineCap="round",t.moveTo(a.attr("x1"),a.attr("y1")),t.lineTo(a.attr("x2"),a.attr("y2"))),t.stroke()})},mp_filter=mps_over_time_data.map(function(t){return t.clean_name}),canvas.on("mousemove",t).on("mouseout",function(){d3.select(tooltip).transition().delay(3e3).style("opacity",0).on("end",function(){mouseover_svg.selectAll(".annotation-group").remove()}),0==IGNORE_STATE&&mouseover_svg.select("line").style("opacity",0)}).on("touchend",t),instance.exit().remove(),current_slide=0}function show_mp_tooltip(t,e){void 0===e&&(e=[3*width/4,3*height/4],isMobile&&(e=[width/2,0])),d3.select("#tooltip").interrupt(),d3.timeout(function(){window.addEventListener("scroll",function(){d3.select("#tooltip").style("opacity",0),mouseover_svg.selectAll(".annotation-group").remove()},{once:!0})},1e3),d3.select("#tooltip").transition().delay(5e3).style("opacity",0).on("end",function(){mouseover_svg.selectAll(".annotation-group").remove()}),d3.select("#tooltip").style("opacity",1).style("transform","translate("+Math.max(Math.min(e[0]-tooltip.offsetWidth/2,width-tooltip.offsetWidth-margin.right),0+margin.left)+"px,"+Math.max(Math.min(e[1]-2*tooltip.offsetHeight-20,height+2*tooltip.offsetHeight-20),margin.top)+"px)").style("pointer-events","none");var a=-1!=partyHasLogo.indexOf(t.party),n='\n                    <h1 style="border-color: '+colorParty(t.party)+';">'+t.name+'</h1>\n                    <div class="body">\n                <div class="mp-image-parent">';void 0===mp_base64_data?n+='<img class="mp-image-blurred" style="opacity: 0;"/>\n                <img class="mp-image" src="./assets/mp-images/mp-'+t.id+'.jpg" />\n                ':void 0!==mp_base64_data[t.id]&&(n+='<img class="mp-image-blurred" src="data:image/jpeg;base64, '+mp_base64_data[t.id]+'"/>\n                <img class="mp-image" src="./assets/mp-images/mp-'+t.id+'.jpg" style="opacity: '+(void 0===t.loaded?0:t.loaded)+(t.loaded=1)+';" onload="this.style.opacity = 1;" />\n                '),n+='</div>\n            <div class="body-facts">\n            <div class="mp-partyname">'+(party_abbreviations[t.party]||t.party)+'</div>\n                    <div class="mp-term">'+d3.timeFormat("%Y")(t.term_start)+" &rarr;                     "+d3.timeFormat("%Y")(t.term_end)+'</div>\n                    <div class="mp-constituency">'+t.constituency+'</div>\n                    </div>\n                    </div>\n                    <div class="mp-party" style="opacity: '+(a?0:1)+'">'+t.party+"</div>\n                    "+(a?'<img class="mp-party-logo" alt="'+t.party+' logo" style="opacity: '+(a?1:0)+'" src="./assets/party_logos/'+t.party+'.svg"/>':"");var o=photo_attribution_data.filter(function(e){return e.id==t.id});if(o.length>0){if("p"==o[0].photo_url)var i=" (Parliament)";else i="w"==o[0].photo_url?" (Wikipedia)":"";n+='<div class="photo-attribution">Photo: '+(o[0].attribution_text+i)+"</div>"}tooltip.innerHTML=n,mouseover_svg.select("line").datum(t).attr("x1",function(t){return x(t.term_start)}).attr("x2",function(t){return x(t.term_end)-1.2*lineThickness}).attr("y1",function(t){return y(t.stream)}).attr("y2",function(t){return y(t.stream)}).style("stroke-width",lineThickness).style("opacity",1),tooltip_timer=d3.timeout(function(){var t=tooltip.getBoundingClientRect(),e=mouseover_svg.select("line").node().getBoundingClientRect();mouseover_svg.selectAll(".annotation-group").remove();var a=d3.annotation().type(d3.annotationLabel).annotations([{note:{title:"...."},connector:{end:"dot"},x:e.x+e.width/2,y:e.y+e.height/2,dx:t.x+t.width/2-e.x,dy:t.bottom-e.y-3}]);mouseover_svg.append("g").attr("class","annotation-group").call(a),mouseover_svg.selectAll(".annotation-group text").style("opacity",0)},300)}function to_first_slide(t){var e=svg.transition().duration(1e3);switch(yLabel.transition(e).text("Number of Women MPs"),t){case 1:e.select("#slide2-group").style("opacity",0).remove(),e.select("#info-bubbles").style("opacity",0).remove();break;case 2:e.select("#slide2-group").style("opacity",0).remove(),e.select("#slide3-group").style("opacity",0).remove(),d3.select("#tooltip").classed("slide3-tooltip",!1).classed("slide5-tooltip",!1)}svg.select(".slide6-annotation-group").style("opacity",0),d3.selectAll(".election-rect").on("mouseover",null).on("mouseout",null),d3.select("#tooltip").style("opacity",0),mouseover_svg.selectAll(".annotation-group").remove(),d3.select("#visible-canvas").style("opacity",1).style("display",null),y.domain([0,220]),gY.transition().duration(1e3).call(yAxis.tickFormat(function(t){return t})),xAxis.scale(x.domain([new Date(1915,1,1),new Date(2020,1,1)])),gX.transition().duration(1e3).call(xAxis),d3.selectAll(".x-axis path").style("opacity",1),pointsGroup.style("opacity",0),e.select("#slide1-group").style("opacity",1),canvas.style("pointer-events","all"),lastTransitioned<0?(lastTransitioned=0,first_slide(!1)):first_slide(!0)}function to_second_slide(t){if(lastTransitioned<1)second_slide(!1),lastTransitioned=1;else{var e=svg.transition().duration(1e3);switch(yLabel.transition(e).text("Number of MPs"),t){case 0:e.select("#slide1-group").style("opacity",0).remove();break;case 2:e.select("#slide3-group").style("opacity",0).remove(),d3.select("#tooltip").classed("slide3-tooltip",!1).classed("slide5-tooltip",!1)}svg.select(".slide6-annotation-group").style("opacity",0),x.domain([new Date(1915,1,1),new Date(2020,1,1)]),xAxis=d3.axisBottom(x),isMobile&&xAxis.ticks(5),gX.transition().duration(1e3).call(xAxis),d3.selectAll(".x-axis path").style("opacity",1),add_election_rects(!0),second_slide(!0)}}function second_slide(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];d3.select("#slide1-group").remove(),d3.select("#holding-div").remove(),d3.select("#slide2-group").remove(),slide2Group=zoomedArea.append("g").attr("id","slide2-group"),t&&slide2Group.style("opacity",0).transition().duration(1e3).style("opacity",1),max_mps_line=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.total_mps)}).curve(d3.curveCardinal),max_mps_path=slide2Group.append("path").attr("class","max-mps-path slide2").datum(total_mps_over_time_data).attr("stroke-width",1.5*lineThickness).attr("d",max_mps_line),max_mps_area=d3.area().curve(d3.curveCardinal).x(function(t){return x(t.year)}).y0(height).y1(function(t){return y(t.total_mps)}),max_mps_path_area=slide2Group.append("path").attr("class","max-mps-area slide2").data([total_mps_over_time_data]).attr("d",max_mps_area).style("opacity",0),mask=slide2Group.append("clipPath").attr("id","slide2-hover-mask").append("path").data([total_mps_over_time_data]).attr("d",max_mps_area),d3.select("#election-rects").attr("clip-path","url(#slide2-hover-mask)").moveToFront().selectAll("rect").style("opacity",.25),half_max_mps_line=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.total_mps/2)}).curve(d3.curveCardinal),half_max_mps_path=slide2Group.append("path").attr("class","half-max-mps-path slide2").datum(total_mps_over_time_data).attr("stroke-width",1.5*lineThickness).attr("d",half_max_mps_line),total_women_mps_line=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.total_women_mps)}).curve(d3.curveBasis);(total_women_mps_path=slide2Group.append("path").attr("class","total-women-mps-path slide2").datum(number_women_over_time_data).attr("stroke-width",1.5*lineThickness).attr("d",total_women_mps_line).style("opacity",0)).node().getBoundingClientRect(),total_women_mps_area=d3.area().curve(d3.curveBasis).x(function(t){return x(t.year)}).y0(height).y1(function(t){return y(t.total_women_mps)}),total_women_mps_path_area=slide2Group.append("path").attr("class","total-women-mps-area slide2").data([number_women_over_time_data]).attr("d",total_women_mps_area).style("opacity",0),d3.select("#tooltip").style("opacity",0),mouseover_svg.selectAll(".annotation-group").remove(),mouseover_svg.select("line").style("opacity",0),canvas.style("pointer-events","none");var e=d3.bisector(function(t){return t.year}).left;if(0==t){dataContainer.selectAll("custom.line").transition().duration(500).attr("x2",function(t){return x(t.term_start)+circleRadius}).transition().duration(500).attr("y1",function(t){return y(number_women_over_time_data[e(number_women_over_time_data,t.term_start)].total_women_mps)}).attr("y2",function(t){return y(number_women_over_time_data[e(number_women_over_time_data,t.term_start)].total_women_mps)});var a=d3.timer(function(t){draw(context,!1),t>1e3&&a.stop()})}var n=d3.scaleLinear().domain([0,220]).range([height,0]),o=d3.line().x(function(t){return x(t.year)}).y(function(t){return n(t.total_women_mps)}).curve(d3.curveBasis).context(context);if(0==t){d3.timeout(function(){context.lineWidth=1.5*lineThickness,context.strokeStyle="#CDCDCD"},1e3);var i=total_women_mps_path.node().getTotalLength();context.setLineDash([i]);var r=d3.easeCubic,s=d3.timer(function(t){var e=r(t/3e3)*i;o(number_women_over_time_data),context.lineDashOffset=-(e+i),context.stroke(),t>3e3&&s.stop()},1e3)}d3.selectAll("#timeline canvas").transition().delay(t?100:4e3).duration(500).style("opacity",0).on("end",function(){context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),d3.select(this).style("display","none")}),total_women_mps_path_area.transition().delay(t?0:4e3).duration(t?0:750).attr("d",total_women_mps_area).style("opacity",1),y.domain([0,750]),yAxis=d3.axisRight(y),yLabel.transition().delay(t?0:4e3).duration(t?0:750).text("Number of MPs"),chartTitle.transition().delay(t?0:4e3).duration(t?0:750).text("MPs in the House of Commons"),credit_alink.attr("xlink:href","http://researchbriefings.parliament.uk/ResearchBriefing/Summary/CBP-7529").select("text").transition().text("Data: House of Commons Library"),slide2Group.append("text").attr("x",x(isMobile?new Date(2019,6,1):new Date(2017,1,1))).attr("y",y(0)-10*lineThickness).attr("class","women-label").text("Women").style("opacity",0).transition().delay(t?0:4e3).duration(t?0:500).style("opacity",1),gY.transition().delay(t?0:5500).duration(t?1e3:750).call(yAxis),total_women_mps_path_area.transition().delay(t?0:5500).duration(t?0:750).attr("d",total_women_mps_area),total_women_mps_path.transition().delay(t?0:6250).duration(0).attr("d",total_women_mps_line),max_mps_path.transition().delay(t?0:6500).duration(t?0:750).attr("d",max_mps_line),max_mps_path_area.transition().delay(t?0:6500).duration(t?0:750).attr("d",max_mps_area).style("opacity",1),mask.transition().delay(t?0:6500).duration(t?0:750).attr("d",max_mps_area),half_max_mps_path.transition().delay(t?0:6500).duration(t?0:750).attr("d",half_max_mps_line),instance.on("mouseover",null).on("mouseout",null).on("click",null),slide2Group.append("text").attr("x",x(new Date(2017,1,1))).attr("y",y(500/750*y.domain()[1])).attr("class","men-label").text("Men").style("opacity",0),slide2Group.append("text").attr("x",x(new Date(1920,1,1))).attr("y",y(700/750*y.domain()[1])).attr("class","party-label").attr("alignment-baseline","hanging").text(""),half_max_mps_line_smooth=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(isMobile?330:t.total_mps/2+1)}).curve(d3.curveBundle.beta(.4)),text_path_50_50=slide2Group.append("defs").append("path").attr("id","half-max-textpath").datum(total_mps_over_time_data).attr("d",half_max_mps_line_smooth),slide2Group.append("text").append("textPath").attr("startOffset","50%").attr("xlink:href","#half-max-textpath").attr("class","i5050-label").text("50:50 gender representation").style("opacity",0),svg.transition().delay(t?0:7e3).on("end",function(){slide2Group.select(".men-label").attr("x",x(isMobile?new Date(2019,6,1):new Date(2017,1,1))).attr("y",y(500/750*y.domain()[1])).transition().duration(t?0:500).style("opacity",1),slide2Group.select(".party-label").attr("y",y(700/750*y.domain()[1])),half_max_mps_line_smooth.y(function(t){return y(t.total_mps/2+1)}),slide2Group.select(".i5050-label").transition().duration(t?0:500).style("opacity",1),electionRects.on("mouseover",function(t,e){d3.select("#tooltip").interrupt(),d3.timeout(function(){window.addEventListener("scroll",function(){d3.select("#tooltip").style("opacity",0),mouseover_svg.selectAll(".annotation-group").remove()},{once:!0})},1e3),d3.select("#tooltip").transition().delay(5e3).style("opacity",0).on("end",function(){mouseover_svg.selectAll(".annotation-group").remove()});var a=d3.mouse(this);d3.select("#tooltip").style("opacity",1).classed("slide3-tooltip",!0).style("transform","translate("+Math.max(Math.min(a[0]-tooltip.offsetWidth/2,width-tooltip.offsetWidth-margin.right),0+margin.left)+"px,"+Math.max(Math.min(a[1]-tooltip.offsetHeight-20,height+tooltip.offsetHeight-20),margin.top)+"px)").style("pointer-events","none"),d3.select(this).classed("hover",!0);var n=t.year,o=total_mps_over_time_data[Math.min(total_mps_over_time_data.length-1,e+1)].year;if(chartTitle.text().includes("Labour")){var i=Math.max.apply(Math,_toConsumableArray(number_women_over_time_data.filter(function(t){return t.year>n&&t.year<=o}).map(function(t){return t.labour_women_mps}))),r=t.labour_mps/i-1;tooltip.innerHTML='<div class="slide2-tooltip"><h1>'+formatDate(n)+" &rarr; "+formatDate(o)+"</h1>\n                        "+(i>0?"<p>"+i+" Wom"+(1==i?"a":"e")+'n</p><hr/>\n                        For every <span class="female">woman</span> Labour MP, there '+(new Date>o?"were":"are")+'\n                        <div class="gender-ratio">'+r.toFixed(1)+'</div> <span class="male">men</span> Labour MPs.':"There were no Labour women in the House of Commons :(")+"\n                        </div>\n                        "}else chartTitle.text().includes("Conservative")?(i=Math.max.apply(Math,_toConsumableArray(number_women_over_time_data.filter(function(t){return t.year>n&&t.year<=o}).map(function(t){return t.conservative_women_mps}))),r=t.conservative_mps/i-1,tooltip.innerHTML='<div class="slide2-tooltip"><h1>'+formatDate(n)+" &rarr; "+formatDate(o)+"</h1>\n                        "+(i>0?"<p>"+i+" Wom"+(1==i?"a":"e")+'n</p><hr/>\n                        For every <span class="female">woman</span> Conservative MP, there '+(new Date>o?"were":"are")+'\n                        <div class="gender-ratio">'+r.toFixed(1)+'</div> <span class="male">men</span> Conservative MPs.':"There were no Conservative women in the House of Commons :(")+"\n                        </div>\n                        "):chartTitle.text().includes("Liberal")?(i=Math.max.apply(Math,_toConsumableArray(number_women_over_time_data.filter(function(t){return t.year>n&&t.year<=o}).map(function(t){return t.lib_snp_women_mps}))),r=t.lib_snp_mps/i-1,tooltip.innerHTML='<div class="slide2-tooltip"><h1>'+formatDate(n)+" &rarr; "+formatDate(o)+"</h1>\n                        "+(i>0?"<p>"+i+" Wom"+(1==i?"a":"e")+'n</p><hr/>\n                        For every <span class="female">woman</span> Lib Dem or SNP MP, there '+(new Date>o?"were":"are")+'\n                        <div class="gender-ratio">'+r.toFixed(1)+'</div> <span class="male">men</span> Lib Dem or SNP MPs.':"There were no Lib Dem or SNP women in the House of Commons yet :(")+"\n                        </div>\n                        "):(i=Math.max.apply(Math,_toConsumableArray(number_women_over_time_data.filter(function(t){return t.year>n&&t.year<=o}).map(function(t){return t.total_women_mps}))),r=t.total_mps/i-1,tooltip.innerHTML='<div class="slide2-tooltip"><h1>'+formatDate(n)+" &rarr; "+formatDate(o)+"</h1>\n        "+(i>0?"<p>"+i+" Wom"+(1==i?"a":"e")+'n</p><hr/>\n            For every <span class="female">female</span> MP, there '+(new Date>o?"were":"are")+'\n                                <div class="gender-ratio">'+r.toFixed(1)+'</div> <span class="male">male</span> MPs.':"There were no women in the House of Commons yet :(")+"\n                                </div>\n            ")}).on("mouseout",function(){d3.select(this).classed("hover",!1)})})}function to_third_slide(t){if(lastTransitioned<2)third_slide(!1),lastTransitioned=2;else{var e=svg.transition().duration(1e3);switch(t){case 0:e.select("#slide1-group").style("opacity",0).remove(),yAxis=d3.axisRight(y).tickFormat(function(t){return t});break;case 1:yAxis=d3.axisRight(y).tickFormat(function(t){return t});break;case 3:d3.select("#slide4").transition(e).style("opacity",0).on("end",function(){this.remove()}),x=d3.scaleUtc().range([0,width]).domain([new Date(1990,1,1),new Date(2017,12,1)]),xAxis=d3.axisBottom(x).tickFormat(function(t){return d3.timeFormat("%Y")(t)}),isMobile&&xAxis.tickValues(x.ticks(8).concat(x.domain())),yAxis=d3.axisRight(y).tickFormat(function(t){return t}),xLabel.text("").style("opacity",1),yLabel.style("opacity",1),gX.call(xAxis).style("opacity",1),gY.call(yAxis).style("opacity",1),d3.select(".y-axis > path").style("opacity",1),d3.select("#slide2-group").style("opacity",1),text_path_50_50.datum(total_mps_over_time_data.slice(20)),canvas.style("pointer-events","none")}svg.select(".slide6-annotation-group").style("opacity",0),d3.selectAll(".x-axis path").style("opacity",1),third_slide(!0)}}function third_slide(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];d3.select("#slide3-group").remove(),d3.select("#info-bubbles").remove(),slide3Group=zoomedArea.append("g").attr("id","slide3-group"),chartTitle.transition().style("opacity",1).text("Parliaments in developed countries"),credit_alink.attr("xlink:href","https://data.worldbank.org/indicator/SG.GEN.PARL.ZS").select("text").transition().text("Data: Inter-parliamentary Union");var e=d3.transition().duration(t?500:1e3);y.domain([0,100]),gY.transition(e).call(yAxis.tickFormat(function(t){return t})),total_women_mps_line.y(function(t){return y(t.women_pct)}),total_women_mps_path.style("opacity",1).transition(e).attr("d",total_women_mps_line);var a=d3.annotation().type(d3.annotationCallout).annotations([{note:{title:"United Kingdom"},connector:{end:"arrow"},x:x(new Date(2017,1,1)),y:y(31),dx:x(new Date(2014,1,1))-x(new Date(2017,1,1)),dy:y(10)-y(31)}]);d3.timeout(function(){slide3Group.append("g").attr("class","country-label").call(a)},t?500:1e3),total_women_mps_area.y1(function(t){return y(t.women_pct)}),total_women_mps_path_area.transition(e).attr("d",total_women_mps_area),max_mps_line.y(function(){return y(100)}),max_mps_path.transition(e).attr("d",max_mps_line),max_mps_area.y1(function(){return y(100)}),max_mps_path_area.transition(e).attr("d",max_mps_area),half_max_mps_line.y(function(){return y(50)}),half_max_mps_path.transition(e).attr("d",half_max_mps_line),half_max_mps_line_smooth.y(function(){return y(51)}),text_path_50_50.transition(e).attr("d",half_max_mps_line_smooth),mask.transition(e).attr("d",max_mps_area),yLabel.transition(e).text("% of Women Representatives");var n=d3.scaleOrdinal(d3.schemeCategory20);x.domain([new Date(1990,1,1),new Date(2017,12,1)]),xAxis.scale(x),isMobile&&xAxis.tickValues(x.ticks(8).concat(x.domain())).tickFormat(function(t){return d3.timeFormat("%Y")(t)});var o=e.transition().duration(t?500:1e3);gX.transition(o).call(xAxis),max_mps_path_area.transition(o).style("opacity",0).remove(),max_mps_path.transition(o).style("opacity",0).remove(),total_women_mps_path.transition(o).attr("d",total_women_mps_line),total_women_mps_path_area.transition(o).style("opacity",0).attr("d",total_women_mps_area).remove(),electionRects.transition(o).style("opacity",0).remove(),d3.selectAll(".women-label,.men-label").transition(o).style("opacity",0).remove();var i=d3.line().curve(d3.curveBasis).x(function(t){return x(t.year)}).y(function(t){return y(t.women_pct)});women_in_govt_data.filter(function(t){return"United Kingdom"==t.key})[0].values=number_women_over_time_data.map(function(t){return{year:t.year,women_pct:t.women_pct,country:"United Kingdom"}}),women_in_govt_paths=slide3Group.selectAll(".women-in-govt-path").data(women_in_govt_data).enter().append("path").attr("d",function(t){return i(t.values)}).attr("class","women-in-govt-path").attr("id",function(t){return t.key.replace(/[^a-zA-Z0-9s]/g,"")}).attr("stroke-width",2*lineThickness).style("stroke",function(t){return"United Kingdom"==t.key?colors.Hover:n(t.key)}).style("fill","none").style("opacity",1).attr("stroke-dasharray",function(){return this.getTotalLength()}).attr("stroke-dashoffset",function(){return this.getTotalLength()});var r=o.transition().duration(t?1e3:2e3);d3.select("#tooltip").classed("slide3-tooltip",!0).style("transform","translate("+Math.max(Math.min(width/2-tooltip.offsetWidth/2,width-tooltip.offsetWidth-margin.right),0+margin.left/2)+"px,"+Math.max(Math.min(-tooltip.offsetHeight-20,height+tooltip.offsetHeight-20),margin.top)+"px)");var s=[];women_in_govt_paths.transition(r).delay(function(e,a){return t?0:1200+1e3*a-100*Math.pow(a,1.5)}).ease(d3.easeCubic).attr("stroke-dashoffset",0).style("opacity",function(t){return"United Kingdom"==t.key?1:.5}).attr("stroke-width",function(t){return"United Kingdom"==t.key?1.5*lineThickness:lineThickness/2}).on("start",function(t){if(2==current_slide){d3.select("#tooltip").style("opacity",1);var e=100/t.values.slice(-1)[0].women_pct-1;tooltip.innerHTML='\n                            <div class="slide3-tooltip">\n                                <h1 style="border-color: '+("United Kingdom"==t.values.slice(-1)[0].country?colors.Hover:n(t.values.slice(-1)[0].country))+'">'+t.values.slice(-1)[0].country+'</h1>\n                                For every <span class="female">woman</span> representative, there were\n                                <div class="gender-ratio">'+e.toFixed(1)+'</div> <span class="male">men</span> representatives in '+t.values.slice(-1)[0].year.getFullYear()+".\n                            </div>"}}).on("end",function(t){s.push(t.key),"United Kingdom"==t.key&&total_women_mps_path.remove()});var l=slide3Group.append("g").attr("transform","translate(-100,-100)").attr("class","focus");l.append("circle").attr("r",3.5),l.append("text").attr("y",-10);var c=slide3Group.append("g").attr("class","voronoi"),d=d3.voronoi().x(function(t){return x(t.year)}).y(function(t){return y(t.women_pct)}).extent([[-margin.left,-margin.top],[width+margin.right,height+margin.bottom]]);c.selectAll("path").data(d.polygons(d3.merge(women_in_govt_data.map(function(t){return t.values})))).enter().append("path").attr("d",function(t){return t?"M"+t.join("L")+"Z":null}).attr("fill","none").attr("pointer-events","all").on("mouseover",function(t){if(d3.select("#tooltip").interrupt(),d3.timeout(function(){window.addEventListener("scroll",function(){d3.select("#tooltip").style("opacity",0)},{once:!0})},1e3),d3.select("#tooltip").transition().delay(5e3).style("opacity",0),s.indexOf(t.data.country)>-1){var e=d3.mouse(this);d3.select("#tooltip").style("opacity",1).style("transform","translate("+Math.max(Math.min(e[0]-tooltip.offsetWidth/2,width-tooltip.offsetWidth/2-margin.right),0+margin.left)+"px,"+Math.max(Math.min(e[1]-tooltip.offsetHeight-20,height+tooltip.offsetHeight-20),margin.top)+"px)").style("pointer-events","none");var a=100/t.data.women_pct-1;tooltip.innerHTML='\n                            <div class="slide3-tooltip">\n                                <h1 style="border-color: '+("United Kingdom"==t.data.country?colors.Hover:n(t.data.country))+';">'+t.data.country+'</h1>\n                                For every <span class="female">woman</span> MP, there were\n                                <div class="gender-ratio">'+a.toFixed(1)+'</div> <span class="male">men</span> MPs in '+t.data.year.getFullYear()+".\n                            </div>",t.line=d3.select("#"+t.data.country.replace(/[^a-zA-Z0-9s]/g,"")),t.line.attr("stroke-width",function(t){return"United Kingdom"==t.key?2*lineThickness:lineThickness}).style("opacity",1)}}).on("mouseout",function(t){s.indexOf(t.data.country)>-1&&t.line.attr("stroke-width",function(t){return"United Kingdom"==t.key?.75*lineThickness:lineThickness/4}).style("opacity",function(t){return"United Kingdom"==t.key?1:.5})})}function to_fourth_slide(t){lastTransitioned<3&&(lastTransitioned=3);var e=svg.transition().duration(1e3);switch(t){case 0:canvas.style("opacity",0).style("pointer-events","none");break;case 1:e.select("#slide2-group").style("opacity",0).remove();break;case 2:d3.select("#slide2-group").style("opacity",0),d3.select("#slide3-group").style("opacity",0),e.on("end",function(){d3.select("#slide3-group").remove()}),d3.select("#tooltip").classed("slide3-tooltip",!1).classed("slide5-tooltip",!1);break;case 4:canvas.style("opacity",0).style("pointer-events","none"),mouseover_svg.select("circle").style("opacity",0),d3.selectAll(".slide5-dropdown, .slide5-search, .x-custom-axis, .switch").style("opacity",0).transition().delay(500).on("end",function(){this.remove()})}electionRects.transition(e).style("opacity",0).remove(),gX.style("opacity",0),gY.style("opacity",0),xLabel.style("opacity",0),yLabel.style("opacity",0),credit_alink.attr("xlink:href",null).select("text").transition().text(""),d3.select("#tooltip").transition(e).style("opacity",0).on("end",function(){chartTitle.transition().text("")})}function to_fifth_slide(t){var e=svg.transition().duration(1e3);switch(t){case 0:e.select("#slide1-group").style("opacity",0).remove();break;case 1:e.select("#slide2-group").style("opacity",0).remove();break;case 2:d3.select("#slide2-group").style("opacity",0),e.select("#slide3-group").style("opacity",0).remove(),d3.select("#tooltip").classed("slide3-tooltip",!1).classed("slide5-tooltip",!1);break;case 5:d3.selectAll("#slide6-group, .x-custom-label, .y-axis").style("opacity",0).style("pointer-events","none").on("end",function(){d3.selectAll(".x-custom-label").remove()})}d3.selectAll("#slide3-group").remove(),svg.select(".slide6-annotation-group").style("opacity",0),d3.select("#tooltip").transition(e).style("opacity",0).on("end",function(){this.innerHTML=""}),electionRects.transition(e).style("opacity",0).on("end",function(){this.remove()}),gX.style("opacity",0),xLabel.style("opacity",0),d3.select(".slide5-dropdown").remove(),lastTransitioned<4?(lastTransitioned=4,fifth_slide(!1)):5==lastTransitioned?d3.transition().duration(600).on("end",function(){fifth_slide(!0)}):fifth_slide(!0),d3.select("#slide4").style("display","none")}function fifth_slide(){function t(t){if(!t)return!1;!function(t){for(var e=0;e<t.length;e++)t[e].classList.remove("autocomplete-active")}(t),r>=t.length&&(r=0),r<0&&(r=t.length-1),t[r].classList.add("autocomplete-active")}function e(t){for(var e=document.getElementsByClassName("autocomplete-items"),a=0;a<e.length;a++)t!=e[a]&&t!=i&&e[a].parentNode.removeChild(e[a])}var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(d3.selectAll(".slide5-dropdown").remove(),credit_alink.attr("xlink:href","https://www.theyworkforyou.com/").select("text").transition().text("Data: TheyWorkForYou (raw transcripts)"),wrapper.select(".x-custom-axis").remove(),wrapper.append("g").attr("class","x-custom-axis").attr("transform","translate(0,"+height+")"),mouseover_svg.select("#zoomed-area").selectAll("*").remove(),mouseover_svg.select("#zoomed-area").append("circle"),d3.select("#visible-canvas").style("opacity",1).style("display",null).style("pointer-events","all"),lastTransitioned>4){var n=d3.histogram().domain([-3,3]).thresholds([-2.5,-1.2,-.5,.5,1.2,2.5]),o={};Object.entries(topic_medians_data).map(function(t){return[t[0],["♂♂♂","♂♂ ","♂  ","⚤  ","♀  ","♀♀ ","♀♀♀"][n([t[1].female>t[1].male?t[1].female/t[1].male-1:-t[1].male/t[1].female+1]).map(function(t){return t.length}).indexOf(1)]+" "+t[0]]}).forEach(function(t){o[t[0]]=t[1]}),d3.select("body").append("span").attr("class","slide5-dropdown"),d3.select(".slide5-dropdown").append("button").text("⟵").on("click",function(){new_slide=5,update_state()}),d3.select(".slide5-dropdown").append("select").attr("id","topic-dropdown").attr("class","slide5-dropdown__select").on("change",update_fifth_slide).selectAll(".topic").data(baked_positions_data.map(function(t){return t.key}).reverse()).enter().append("option").attr("selected",function(t){return t==selected_topic?"selected":null}).attr("value",function(t){return t}).text(function(t){return t.toUpperCase()})}d3.selectAll(".slide5-search").remove(),d3.select("body").append("span").attr("class","slide5-search").append("input").attr("id","mp-search").attr("type","text").attr("placeholder","🔎 Search for your MP by name or constituency");var i=document.getElementById("mp-search"),r=void 0;i.addEventListener("keydown",function(e){var a=document.getElementById(this.id+"autocomplete-list");a&&(a=a.getElementsByTagName("div")),null!=a&&(40==e.keyCode?(r++,isMobile||slide5_show_mp_tooltip(temp_nodes.slice(2).filter(function(t){return t.id==a[r].getElementsByTagName("input")[0].value})[0]),t(a)):38==e.keyCode?(r--,isMobile||slide5_show_mp_tooltip(temp_nodes.slice(2).filter(function(t){return t.id==a[r].getElementsByTagName("input")[0].value})[0]),t(a)):13==e.keyCode&&(e.preventDefault(),r>-1&&a&&a[r].click()))}),document.getElementById("mp-search").addEventListener("input",function(){var t=i.value.toLowerCase(),a=temp_nodes.slice(2).filter(function(e){return e.search_string.includes(t)}).sort(function(e,a){return e.search_string.search(t)-a.search_string.search(t)});if(e(),1==a.length?slide5_show_mp_tooltip(a[0]):(d3.select(tooltip).style("opacity",0),mouseover_svg.selectAll(".annotation-group").remove()),!t)return!1;r=-1;var n=document.createElement("DIV");n.setAttribute("id",i.id+"autocomplete-list"),n.setAttribute("class","autocomplete-items"),i.parentNode.appendChild(n);for(var o=0;o<a.length;o++){var s=document.createElement("DIV"),l=a[o].full_name+" ("+a[o].party+"-"+a[o].constituency+")",c=l.toLowerCase().search(t);s.innerHTML=-1!=c?l.slice(0,c)+"<b>"+l.slice(c,c+t.length)+"</b>"+l.slice(c+t.length):l,s.innerHTML+="<input type='hidden' value='"+a[o].id+"'>",s.addEventListener("click",function(){var t=this;i.value=temp_nodes.slice(2).filter(function(e){return e.id==t.getElementsByTagName("input")[0].value})[0].full_name,slide5_show_mp_tooltip(temp_nodes.slice(2).filter(function(e){return e.id==t.getElementsByTagName("input")[0].value})[0]),e()}),n.appendChild(s)}}),slide5_xScale=d3.scaleLinear().domain([-450,150]).range([margin.left,width+margin.left]),slide5_yScale=d3.scaleLinear().domain([-.005,.3]).range([height,0]),y=slide5_yScale,yAxis=d3.axisRight(y).ticks(10).tickFormat(function(t){return 10*t%1==0?(100*t).toFixed(0)+"%":""}),gY.call(yAxis).attr("transform","translate("+width+", 0)").attr("text-anchor","start").style("opacity",1),d3.select(".y-axis path").style("opacity",0),yLabel.text("% of time spent on topic").style("opacity",1),d3.select("#slide5-group").remove(),void 0!==selected_topic?update_fifth_slide(a,selected_topic):(update_fifth_slide(a,"economy",!0,!1),chartTitle.transition().text("Time spent on the economy"))}function update_fifth_slide(t,e,a,n){function o(){var t=d3.mouse(this);if(void 0!==transform)var e=s.find((t[0]-margin.left-transform.x)/transform.k,(t[1]-margin.top-transform.y)/transform.k,50);else e=s.find(t[0]-margin.left,t[1]-margin.top,50);void 0!==e&&(void 0!==e.id?slide5_show_mp_tooltip(e,t):function(t,e){d3.select("#tooltip").interrupt(),d3.timeout(function(){window.addEventListener("scroll",function(){d3.select("#tooltip").style("opacity",0),mouseover_svg.selectAll(".annotation-group").remove()},{once:!0})},1e3),d3.select("#tooltip").transition().delay(5e3).style("opacity",0).on("end",function(){mouseover_svg.selectAll(".annotation-group").remove()}),d3.select("#tooltip").style("opacity",1).classed("slide5-tooltip",!0).style("transform","translate("+Math.max(Math.min(e[0]-tooltip.offsetWidth/2,width-tooltip.offsetWidth/2-margin.right),0+margin.left)+"px,"+Math.max(Math.min(e[1]-tooltip.offsetHeight-20,height+tooltip.offsetHeight-20),margin.top)+"px)").style("pointer-events","none"),tooltip.innerHTML='\n                            <div class="slide5-tooltip">\n                    <h1 style="border-color: '+("female"==t.gender?colors.Female:colors.Male)+';">'+("female"==t.gender.toUpperCase()?"WOMEN":"MEN")+"</h1>\n                    The average "+("female"==t.gender.toUpperCase()?"WOMAN":"MAN")+" MP spends <em>"+(100*t.median).toFixed(1)+"%</em> of "+("male"==t.gender?"his":"her")+" time talking about <em>"+selected_topic+"</em>.\n</div>",mouseover_svg.select("circle").datum(t).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",2.5*circleRadius).style("opacity",1).style("stroke-width",circleRadius),annotate_timer=d3.timeout(function(){var t=tooltip.getBoundingClientRect(),e=mouseover_svg.select("circle").node().getBoundingClientRect();mouseover_svg.selectAll(".annotation-group").remove();var a=d3.annotation().type(d3.annotationLabel).annotations([{note:{title:"...."},connector:{end:"dot"},x:e.x+e.width/2,y:e.y+e.width/2,dx:t.x+t.width/2-e.x,dy:t.bottom-e.y-3}]);mouseover_svg.append("g").attr("class","annotation-group").call(a),mouseover_svg.selectAll(".annotation-group text").style("opacity",0)},300)}(e,t)),d3.event.preventDefault()}if(void 0===a&&(a=!1),void 0===n&&(n=!0),mouseover_svg.select("circle").style("opacity",0),d3.select("#tooltip").style("opacity",0),mouseover_svg.selectAll(".annotation-group").remove(),null!=document.getElementById("zoom-checkbox")&&0!=document.getElementById("zoom-checkbox").checked&&document.getElementById("zoom-checkbox").click(),void 0!==e&&"number"!=typeof e&&a)selected_topic=e,chartTitle.style("opacity",1);else{chartTitle.style("opacity",0);try{selected_topic=d3.select("#topic-dropdown").property("value")}catch(t){var i=Object.keys(topic_medians_data);selected_topic=selected_topic||i[Math.floor(Math.random()*i.length)]}}chartTitle.transition().text("Time spent on "+selected_topic);var r=baked_positions_data.filter(function(t){return t.key==selected_topic})[0].values;nodes_male=r.filter(function(t){return"Male"==t.gender}),nodes_female=r.filter(function(t){return"Male"!=t.gender}),(temp_nodes=[]).push({x:slide5_xScale(0),y:slide5_yScale(topic_medians_data[selected_topic].female),median:topic_medians_data[selected_topic].female,gender:"female"}),temp_nodes.push({x:slide5_xScale(0),y:slide5_yScale(topic_medians_data[selected_topic].male),median:topic_medians_data[selected_topic].male,gender:"male"}),nodes_male.forEach(function(t){var e=Object.assign({},t);e.x=slide5_xScale(t.x)-10,e.y=slide5_yScale(t.y),temp_nodes.push(e)}),nodes_female.forEach(function(t){var e=Object.assign({},t);e.x=slide5_xScale(t.x)+10,e.y=slide5_yScale(t.y),temp_nodes.push(e)});var s=d3.quadtree().extent([[-1,-1],[width+1,height+1]]).x(function(t){return t.x}).y(function(t){return t.y}).addAll(temp_nodes);(circle_male=dataContainer.selectAll(".male-node").data(nodes_male)).transition().duration(1500).attr("opacity",.7).attr("cx",function(t){return slide5_xScale(t.x)-10}).attr("cy",function(t){return slide5_yScale(t.y)}),circle_male.enter().append("custom").attr("class","male-node").attr("r",circleRadius*(isMobile?.9:1.2)).attr("cx",function(e){return t?e.x:slide5_xScale(0)}).attr("cy",function(t){return slide5_yScale(t.y)}).attr("opacity",0).transition().duration(2e3).delay(function(e,a){return t?0:100*Math.sqrt(a)}).attr("opacity",.7).attr("cx",function(t){return slide5_xScale(t.x)-10}).attr("cy",function(t){return slide5_yScale(t.y)}),(circle_female=dataContainer.selectAll(".female-node").data(nodes_female)).transition().duration(1500).attr("opacity",.7).attr("cx",function(t){return slide5_xScale(t.x)+10}).attr("cy",function(t){return slide5_yScale(t.y)}),circle_female.enter().append("custom").attr("class","female-node").attr("r",circleRadius*(isMobile?.9:1.2)).attr("cx",function(e){return t?e.x:slide5_xScale(0)}).attr("cy",function(t){return slide5_yScale(t.y)}).attr("opacity",0).transition().duration(2e3).delay(function(e,a){return t?0:100*Math.sqrt(a)}).attr("opacity",.7).attr("cx",function(t){return slide5_xScale(t.x)+10}).attr("cy",function(t){return slide5_yScale(t.y)});var l=dataContainer.selectAll(".median-connector").data([topic_medians_data[selected_topic]]);l.transition().duration(1500).attr("x1",slide5_xScale(0)).attr("x2",slide5_xScale(0)).attr("y1",function(t){return slide5_yScale(n?t.female:.5)}).attr("y2",function(t){return slide5_yScale(n?t.male:.5)}).attr("opacity",n?1:0),l.enter().append("custom").attr("class","median-connector").attr("x1",slide5_xScale(0)).attr("x2",slide5_xScale(0)).transition().delay(2e3).duration(1e3).attr("y1",function(t){return slide5_yScale(n?t.female:.5)}).attr("y2",function(t){return slide5_yScale(n?t.male:.5)}).attr("opacity",n?1:0);var c=dataContainer.selectAll(".male-median").data([topic_medians_data[selected_topic].male]);c.transition().duration(1500).attr("cx",slide5_xScale(0)).attr("cy",function(t){return slide5_yScale(n?t:0)}).attr("opacity",n?1:0),c.enter().append("custom").attr("class","male-median").attr("cx",slide5_xScale(0)).attr("cy",slide5_yScale(0)).attr("r",2*circleRadius).attr("opacity",n?1:0).transition().delay(2e3).duration(1e3).attr("cy",function(t){return slide5_yScale(n?t:0)});var d=dataContainer.selectAll(".female-median").data([topic_medians_data[selected_topic].female]);d.transition().duration(1e3).attr("cy",function(t){return slide5_yScale(n?t:0)}).attr("opacity",n?1:0),d.enter().append("custom").attr("class","female-median").attr("cx",slide5_xScale(0)).attr("cy",slide5_yScale(0)).attr("r",2*circleRadius).attr("opacity",n?1:0).transition().delay(2e3).duration(1e3).attr("cy",function(t){return slide5_yScale(n?t:0)}),context_hidden.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),window.draw=function(t){t.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),dataContainer.selectAll("custom.male-node").each(function(){var e=d3.select(this);t.fillStyle=hexToRGBA(colors.Male,e.attr("opacity")),t.beginPath(),t.arc(e.attr("cx"),e.attr("cy"),e.attr("r"),0,2*Math.PI),t.fill()}),dataContainer.selectAll("custom.female-node").each(function(){var e=d3.select(this);t.fillStyle=hexToRGBA(colors.Female,e.attr("opacity")),t.beginPath(),t.arc(e.attr("cx"),e.attr("cy"),e.attr("r"),0,2*Math.PI),t.fill()}),dataContainer.select("custom.median-connector").each(function(){var e=d3.select(this);t.beginPath(),t.lineWidth=1,t.strokeStyle=hexToRGBA("#ffffff",e.attr("opacity")),t.moveTo(e.attr("x1"),e.attr("y1")),t.lineTo(+e.attr("x2"),e.attr("y2")),t.stroke()}),dataContainer.select("custom.male-median").each(function(){var e=d3.select(this);t.fillStyle=hexToRGBA(colors.Male,e.attr("opacity")),t.beginPath(),t.arc(e.attr("cx"),e.attr("cy"),e.attr("r"),0,2*Math.PI),t.fill()}),dataContainer.select("custom.female-median").each(function(){var e=d3.select(this);t.fillStyle=hexToRGBA(colors.Female,e.attr("opacity")),t.beginPath(),t.arc(e.attr("cx"),e.attr("cy"),e.attr("r"),0,2*Math.PI),t.fill()})};var m=d3.timer(function(t){draw(context,!1),initial_slide5&t>6e3|1!=initial_slide5&t>3e3&&(m.stop(),draw(context),initial_slide5=!1)});window.draw_custom_labels=function(){var t=d3.selectAll(".x-axis text").nodes(),e=t[t.map(function(t){return+t.textContent}).indexOf(8)];void 0===e&&(e=t.filter(function(t){return+t.textContent>0})[0]);var a=t[t.map(function(t){return+t.textContent}).indexOf(-8)];void 0===a&&(a=(a=t.filter(function(t){return+t.textContent<0}))[a.length-1]),wrapper.select(".x-custom-axis").selectAll("*").remove(),void 0!==a&&wrapper.select(".x-custom-axis").append("text").attr("class","x-label x-custom-label").attr("transform",a.parentNode.getAttribute("transform")).attr("dy",10).style("text-anchor","end").style("fill",colors.Male).html("Men"),void 0!==e&&wrapper.select(".x-custom-axis").append("text").attr("class","x-label x-custom-label").attr("transform",e.parentNode.getAttribute("transform")).attr("dy",10).style("text-anchor","start").style("fill",colors.Female).html("Women")},gX.call(d3.axisBottom(slide5_xScale).ticks(20)),draw_custom_labels(),mouseover_svg.selectAll(".female-label, .male-label").remove();try{annotate_timer.stop()}catch(t){}if(n){var p=d3.annotation().type(d3.annotationCallout).annotations([{note:{title:"Median woman: "+(100*topic_medians_data[selected_topic].female).toFixed(1)+"%"},connector:{end:"dot"},x:slide5_xScale(0),y:slide5_yScale(topic_medians_data[selected_topic].female),dx:slide5_xScale(-100)-slide5_xScale(0),dy:slide5_yScale(topic_medians_data[selected_topic].female>topic_medians_data[selected_topic].male?.15:.05)-slide5_yScale(topic_medians_data[selected_topic].female)}]),u=d3.annotation().type(d3.annotationCallout).annotations([{note:{title:"Median man: "+(100*topic_medians_data[selected_topic].male).toFixed(1)+"%"},connector:{end:"dot"},x:slide5_xScale(0),y:slide5_yScale(topic_medians_data[selected_topic].male),dx:slide5_xScale(-100)-slide5_xScale(0),dy:slide5_yScale(topic_medians_data[selected_topic].male>topic_medians_data[selected_topic].female?.15:.05)-slide5_yScale(topic_medians_data[selected_topic].male)}]);annotate_timer=d3.timeout(function(){mouseover_svg.select(".timeline-wrapper").append("g").attr("class","female-label").call(p),mouseover_svg.select(".timeline-wrapper").append("g").attr("class","male-label").call(u)},1500)}canvas.on("mousemove",o).on("drag",o).on("touchend",o),window.slide5_show_mp_tooltip=function(t,e){d3.select("#tooltip").interrupt(),d3.timeout(function(){window.addEventListener("scroll",function(){d3.select("#tooltip").style("opacity",0),mouseover_svg.selectAll(".annotation-group").remove()},{once:!0})},1e3),d3.select("#tooltip").transition().delay(5e3).style("opacity",0).on("end",function(){mouseover_svg.selectAll(".annotation-group").remove()}),void 0===e&&(e=[t.x,t.y]),d3.select("#tooltip").style("opacity",1).classed("slide5-tooltip",!0).style("transform","translate("+Math.max(Math.min(e[0]-tooltip.offsetWidth,width-tooltip.offsetWidth-margin.right),0+margin.left)+"px,"+Math.max(Math.min(e[1]-tooltip.offsetHeight-20,height+tooltip.offsetHeight-20),margin.top)+"px)").style("pointer-events","none");var a=-1!=partyHasLogo.indexOf(t.party),n=photo_attribution_data.filter(function(e){return e.id==t.id});if(n.length>0)if("p"==n[0].photo_url)var o=" (Parliament)";else o="w"==n[0].photo_url?" (Wikipedia)":"";tooltip.innerHTML='\n                            <div class="slide5-tooltip">\n                    <h1 style="border-color: '+colorParty(t.party)+';">'+t.full_name+'</h1>\n                    <div class="body">\n                    <div class="mp-image-parent">\n                    '+(void 0===mp_base64_data[t.id]?"":'<img class="mp-image-blurred" src="data:image/jpeg;base64,'+mp_base64_data[t.id]+'" /><img class="mp-image" src="./assets/mp-images/mp-'+t.id+'.jpg" style="opacity: ${typeof nodeData.loaded == \'undefined\' ? 0 : nodeData.loaded;d.loaded = 1;};" onload="this.style.opacity = 1;" />')+'\n                    </div>\n                    <div class="body-facts">\n            <div class="mp-partyname">'+(party_abbreviations[t.party]||t.party)+'</div>\n                    <div class="mp-constituency">'+t.constituency+"</div>\n                    <p>"+(100*slide5_yScale.invert(t.y)).toFixed(1)+"%</em> of "+("Female"==t.gender?"her":"his")+" time spent on <em>"+selected_topic+'</em></p>\n                    </div>\n                    </div>\n                    <div class="mp-party" style="opacity: '+(a?0:1)+'">'+t.party+"</div>\n                    "+(a?'<img class="mp-party-logo" alt="'+t.party+' logo" style="opacity: '+(a?1:0)+'" src="./assets/party_logos/'+t.party+'.svg"/>':"")+'\n                    <div class="photo-attribution">'+(n.length>0?"Photo: "+n[0].attribution_text+o:"")+"</div>\n</div>",mouseover_svg.select("circle").datum(t).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",2.5*circleRadius).style("opacity",1).style("stroke-width",circleRadius),d3.timeout(function(){var t=tooltip.getBoundingClientRect(),e=mouseover_svg.select("circle").node().getBoundingClientRect();mouseover_svg.selectAll(".annotation-group").remove();var a=d3.annotation().type(d3.annotationLabel).annotations([{note:{title:"...."},connector:{end:"dot"},x:e.x+e.width/2,y:e.y+e.width/2,dx:t.x+t.width/2-e.x,dy:t.bottom-e.y-3}]);mouseover_svg.append("g").attr("class","annotation-group").call(a),mouseover_svg.selectAll(".annotation-group text").style("opacity",0)},300)}}function to_sixth_slide(t){var e=svg.transition().duration(1e3);switch(t){case 0:e.select("#slide1-group").style("opacity",0).remove();break;case 1:d3.select("#slide2-group").style("opacity",0);break;case 2:d3.select("#slide2-group").style("opacity",0),e.select("#slide3-group").style("opacity",0).on("end",function(){this.remove()}),d3.select("#tooltip").classed("slide3-tooltip",!1).classed("slide5-tooltip",!1);break;case 3:d3.select("#slide4").style("opacity",0).transition().delay(1e3).on("end",function(){this.remove()});break;case 4:chartTitle.style("opacity",1),d3.selectAll(".slide5-dropdown, .slide5-search, .x-custom-axis").style("opacity",0).transition().delay(1e3).on("end",function(){this.remove()}),d3.select(".y-axis").style("opacity",0),yLabel.style("opacity",0),d3.select(".switch").style("opacity",0).style("display","none"),null!=document.getElementById("zoom-checkbox")&&0!=document.getElementById("zoom-checkbox").checked&&document.getElementById("zoom-checkbox").click(),mouseover_svg.selectAll(".female-label, .male-label").remove(),d3.selectAll(".annotation-group").remove();break;case 6:d3.select("#slide7-group").style("opacity",0).style("pointer-events","none"),d3.selectAll(".x-axis path").style("opacity",1)}d3.selectAll("#slide3-group").remove(),d3.select("#tooltip").transition(e).style("opacity",0).on("end",function(){this.innerHTML=""}),electionRects.transition(e).style("opacity",0).remove(),void 0===slide6Group&&(lastTransitioned=4,d3.selectAll("#slide7-group").remove()),lastTransitioned<5?(x=d3.scaleLinear().range([0,width]).domain([0,.1]),xAxis=d3.axisBottom(x).ticks(6).tickFormat(function(t){return(100*t).toFixed(0)+"%"})):(x=d3.scaleLinear().range([0,width]).domain([-3,3]),xAxis=d3.axisBottom(x).ticks(6).tickFormat(function(t){return(100*t).toFixed(0)+"%"}),canvas.style("opacity",0).style("display",null).style("pointer-events","none")),gX.transition().call(xAxis),y=d3.scalePoint().range([height,0]).padding(1),yAxis=d3.axisRight(y),gY.style("opacity",0).call(yAxis),d3.selectAll(".y-axis > .tick text").style("transition",null),lastTransitioned<5?e.on("end",function(){sixth_slide(!1),lastTransitioned=5}):e.on("end",function(){return sixth_slide(!0)})}function sixth_slide(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];0==(t=lastTransitioned>=5)?(d3.select("#slide6-group").remove(),slide6Group=zoomedArea.append("g").attr("id","slide6-group")):d3.select("#slide6-group").style("pointer-events","unset"),canvas.style("opacity",0).style("display",null).style("pointer-events","none"),mouseover_svg.select("circle").style("opacity",0),d3.select(".slide5-dropdown").style("opacity",0).remove(),d3.select(".slide5-search").style("opacity",0).remove(),credit_alink.attr("xlink:href",null).select("text").transition().text("");var e=Object.entries(topic_medians_data).sort(function(t,e){return t[1].female/t[1].male-e[1].female/e[1].male});y.domain(e.map(function(t){return t[0]})),yAxis=d3.axisRight(y),gY.transition().attr("transform",null).attr("text-anchor","start").call(yAxis);var a=e.map(function(t){return x.range()[1]-x(Math.max(t[1].male,t[1].female))>x(Math.min(t[1].male,t[1].female))-x.range()[0]?"start":"end"});d3.selectAll(".y-axis > .tick text").transition().delay(500).duration(1).attr("x",function(t,n){return"start"==a[n]?x(Math.max(e[n][1].male,e[n][1].female))+5:x(Math.min(e[n][1].male,e[n][1].female))-5}).style("text-anchor",function(t,e){return a[e]}),d3.select(".y-axis > path").style("opacity",0),d3.selectAll(".y-axis > .tick line").style("opacity",0);var n=d3.transition().duration(1e3);if(4==lastTransitioned){d3.selectAll(".y-axis > .tick text").style("opacity",function(t){return t==selected_topic?1:0});var o=slide6Group.selectAll(".median-connector").data([topic_medians_data[selected_topic]]);o.enter().append("line").attr("class","median-connector tmp").attr("stroke-width",1).attr("x1",slide5_xScale(0)).attr("x2",slide5_xScale(0)).attr("y1",function(t){return slide5_yScale(t.female)}).attr("y2",function(t){return slide5_yScale(t.male)}).transition(n).attr("x1",function(t){return x(t.female)}).attr("x2",function(t){return x(t.male)}).attr("y1",y(selected_topic)).attr("y2",y(selected_topic));var i=slide6Group.selectAll(".male-median").data([topic_medians_data[selected_topic].male]);i.enter().append("circle").attr("class","male-median tmp").attr("cx",slide5_xScale(0)).attr("cy",function(t){return slide5_yScale(t)}).attr("r",3).transition(n).attr("cx",function(t){return x(t)}).attr("cy",y(selected_topic));var r=slide6Group.selectAll(".female-median").data([topic_medians_data[selected_topic].female]);r.enter().append("circle").attr("class","female-median tmp").attr("cx",slide5_xScale(0)).attr("cy",function(t){return slide5_yScale(t)}).attr("r",3).transition(n).attr("cx",function(t){return x(t)}).attr("cy",y(selected_topic)).on("end",function(){chartTitle.transition().text("Gender bias of topics"),gX.style("opacity",1),gY.style("opacity",1),xLabel.text("Average % of time spent on topic").style("opacity",1)})}else o=slide6Group.selectAll(".median-connector").data(e),i=slide6Group.selectAll(".male-median").data(e),r=slide6Group.selectAll(".female-median").data(e),chartTitle.transition().text("Gender bias of topics"),xLabel.text("Relative gender bias").style("opacity",1),gX.style("opacity",1),gY.style("opacity",1),yLabel.style("opacity",0);var s=n.transition().duration(500);if(0==t){o.data(e).enter().append("line").attr("class",function(t,e){return"median-connector topic-"+e}).attr("stroke-width",1).attr("x1",x(0)).attr("x2",x(0)).attr("y1",function(t){return y(t[0])}).attr("y2",function(t){return y(t[0])}).attr("opacity",0).transition(s).delay(function(t,e){return 1e3+50*e}).attr("opacity",function(t){return t[0]==selected_topic?0:1}).attr("x1",function(t){return x(t[1].female)}).attr("x2",function(t){return x(t[1].male)}),i.data(e).enter().append("circle").attr("class",function(t,e){return"male-median topic-"+e}).attr("r",3).attr("cx",x(0)).attr("cy",function(t){return y(t[0])}).attr("opacity",0).transition(s).delay(function(t,e){return 1e3+50*e}).attr("opacity",function(t){return t[0]==selected_topic?0:1}).attr("cx",function(t){return x(t[1].male)}),r.data(e).enter().append("circle").attr("class",function(t,e){return"female-median topic-"+e}).attr("r",3).attr("cx",x(0)).attr("cy",function(t){return y(t[0])}).attr("opacity",0).transition(s).delay(function(t,e){return 1e3+50*e}).attr("opacity",function(t){return t[0]==selected_topic?0:1}).attr("cx",function(t){return x(t[1].female)}),d3.selectAll(".y-axis > .tick text").transition(s).delay(function(t,e){return 1800+50*e}).style("opacity",1);var l=s.transition().delay(2500).on("end",function(){slide6Group.selectAll(".topic-"+e.map(function(t){return t[0]}).indexOf(selected_topic)).attr("opacity",1),slide6Group.selectAll(".tmp").remove()});slide6Group.selectAll(".hover-rect").data(e).enter().append("rect").attr("class","hover-rect").attr("x",x(0)).attr("y",function(t){return y(t[0])-y.step()/2}).attr("width",width).attr("height",y.step()).on("mouseover",function(t,e){slide6Group.selectAll("circle.topic-"+e).attr("r",6),slide6Group.select("line.topic-"+e).attr("stroke-width",3)}).on("mouseout",function(t,e){slide6Group.selectAll("circle.topic-"+e).attr("r",3),slide6Group.select("line.topic-"+e).attr("stroke-width",1)}).on("click",function(t){selected_topic=t[0],new_slide=4,d3.select(".is-active").style("opacity",0).style("pointer-events","none"),update_state()}),wrapper.selectAll(".x-custom-label").remove(),wrapper.append("text").attr("class","x-custom-label").attr("x",width).attr("y",height+(isMobile?2*margin.bottom/3:margin.bottom)).text("Discussed more by women"+(isMobile?"→":" ⟶")).style("text-anchor","end").style("fill",colors.Female).style("alignment-baseline","hanging").style("opacity",0),wrapper.append("text").attr("class","x-custom-label").attr("x",0).attr("y",height+(isMobile?2*margin.bottom/3:margin.bottom)).text((isMobile?"←":"⟵ ")+"Discussed more by men").style("text-anchor","start").style("fill",colors.Male).style("alignment-baseline","hanging").style("opacity",0),svg.selectAll(".slide6-annotation-group").remove();var c=d3.annotation().type(d3.annotationCallout).annotations([{note:{title:"up to 460%"},connector:{end:"arrow",endScale:.5},x:margin.left+width,y:margin.top+10,dx:isMobile?-20:-50,dy:isMobile?-10:-20}]);svg.append("g").attr("class","slide6-annotation-group").call(c).style("opacity",0);var d=l.transition().delay(1e3).on("end",function(){x.domain([-3,3]),xAxis=d3.axisBottom(x).ticks(6).tickFormat(function(t){return(100*t).toFixed(0)+"%"}),gX.transition().call(xAxis).on("end",function(){var t=d3.transition().duration(1e3);slide6Group.selectAll(".median-connector").transition(t).delay(function(t,e){return 50*e}).attr("x1",function(t){return x(t[1].female>t[1].male?t[1].female/t[1].male-1:-t[1].male/t[1].female+1)}).attr("x2",x(0)),slide6Group.selectAll(".female-median").transition(t).delay(function(t,e){return 50*e}).attr("cx",function(t){return x(t[1].female>t[1].male?t[1].female/t[1].male-1:0)}),slide6Group.selectAll(".male-median").transition(t).delay(function(t,e){return 50*e}).attr("cx",function(t){return x(t[1].female<t[1].male?-t[1].male/t[1].female+1:0)}),d3.selectAll(".y-axis > .tick text").style("opacity",0),xLabel.text("Relative gender bias"),wrapper.selectAll(".x-custom-label").style("opacity",1),svg.select(".slide6-annotation-group").transition(t).delay(1650).style("opacity",1)})}).transition()}else slide6Group.selectAll(".median-connector").attr("x1",function(t){return x(t[1].female>t[1].male?t[1].female/t[1].male-1:-t[1].male/t[1].female+1)}).attr("x2",x(0)),slide6Group.selectAll(".female-median").attr("cx",function(t){return x(t[1].female>t[1].male?t[1].female/t[1].male-1:0)}),slide6Group.selectAll(".male-median").attr("cx",function(t){return x(t[1].female<t[1].male?-t[1].male/t[1].female+1:0)}),d=d3.transition().on("end",function(){slide6Group.style("opacity",1)}),wrapper.selectAll(".x-custom-label").style("opacity",1),svg.select(".slide6-annotation-group").style("opacity",1);a=e.map(function(t){return t[1].female-t[1].male>0}),d3.selectAll(".y-axis > .tick text").filter(function(t){return-1!=Object.keys(topic_medians_data).indexOf(t)}).transition(d).delay(function(){return t?0:2e3}).duration(t?1:0).style("text-anchor",function(t,e){return a[e]?"end":"start"}).attr("x",function(t,e){return a[e]?x.domain([-.06,.06])(-.001):x.domain([-.06,.06])(.001)}).transition().delay(1e3).duration(500).style("opacity",1)}function to_seventh_slide(t){var e=svg.transition().duration(1e3);switch(t){case 0:e.select("#slide1-group").style("opacity",0).remove();break;case 1:d3.select("#slide2-group").style("opacity",0);break;case 2:d3.select("#slide2-group").style("opacity",0),e.select("#slide3-group").style("opacity",0).on("end",function(){this.remove()}),d3.select("#tooltip").classed("slide3-tooltip",!1).classed("slide5-tooltip",!1);break;case 3:d3.select("#slide4").style("opacity",0).transition().delay(1e3).on("end",function(){this.remove()});break;case 4:chartTitle.style("opacity",1),d3.selectAll(".slide5-dropdown, .slide5-search, .x-custom-axis").remove(),d3.select(".switch").style("opacity",0).style("display","none"),null!=document.getElementById("zoom-checkbox")&&0!=document.getElementById("zoom-checkbox").checked&&document.getElementById("zoom-checkbox").click(),mouseover_svg.selectAll(".female-label, .male-label").remove(),mouseover_svg.select("circle").style("opacity",0);break;case 5:d3.selectAll("#slide6-group, .x-custom-label").style("opacity",0).style("pointer-events","none").on("end",function(){d3.selectAll(".x-custom-label").remove()})}d3.selectAll("#slide3-group").remove(),svg.select(".slide6-annotation-group").transition().style("opacity",0),mouseover_svg.selectAll(".female-label, .male-label").remove(),d3.selectAll(".slide5-dropdown, .slide5-search, .x-custom-axis, .x-custom-label").remove(),d3.select("#tooltip").transition(e).style("opacity",0).on("end",function(){this.innerHTML=""}),electionRects.transition(e).style("opacity",0).remove(),canvas.style("opacity",0).style("display","none").style("pointer-events","none"),x=d3.scaleBand().range([0,width]).domain(parliamentary_candidates_data.map(function(t){return t.year})).paddingInner(.2),xAxis=d3.axisBottom(x),gX.transition(e).call(xAxis).style("opacity",1).on("end",function(){d3.selectAll(".x-axis path").style("opacity",0),d3.selectAll(".x-axis text").attr("transform","rotate(-45)").attr("text-anchor","end").attr("dx",-5)}),y=d3.scaleLinear().domain([0,1100]).range([height,0]),yAxis=d3.axisRight(y).ticks(5).tickFormat(function(t){return t}),gY.style("opacity",0),d3.timeout(function(){gY.transition(e).call(yAxis).attr("transform","translate("+width+", 0)").style("opacity",1)},1e3),xLabel.style("opacity",1),yLabel.style("opacity",1),lastTransitioned<6?e.on("end",function(){seventh_slide(!1),lastTransitioned=6}):e.on("end",function(){return seventh_slide(!0)})}function seventh_slide(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t=lastTransitioned>=6,xLabel.text(""),yLabel.text("Number of Women Parliamentary Candidates"),chartTitle.text("Women Parliamentary Candidates"),credit_alink.attr("xlink:href",null).select("text").transition().text(""),t)var e=d3.select("#slide7-group").style("opacity",1).style("pointer-events","unset");else{d3.select("#slide7-group").selectAll("*").remove().style("pointer-events","unset");var a=(e=zoomedArea.append("g").attr("id","slide7-group")).append("g").selectAll("g").data(d3.stack().keys(["Labour","Conservative","Liberal","Other"])(parliamentary_candidates_data)).enter().append("g").attr("fill",function(t){return colors[t.key]}).selectAll("g").data(function(t){return t.map(function(e){return e.party=t.key,e}),t}).enter().append("g");a.append("rect").attr("x",function(t){return x(t.data.year)}).attr("y",height).attr("height",0).attr("width",x.bandwidth()).transition().duration(500).delay(function(t,e){return 100*e}).attr("y",function(t){return y(t[1])}).attr("height",function(t){return y(t[0])-y(t[1])}).style("stroke-dasharray",function(t){return"Future"==t.data.year?"5,5":"unset"}).style("stroke",function(t){return"Future"==t.data.year?colors.Hover:"unset"}).style("fill",function(t){return"Future"==t.data.year?"none":"unset"}),a.append("text").classed("bar-label",!0).attr("x",function(t){return x(t.data.year)+x.bandwidth()/2}).attr("y",function(t){return y(t[1])}).attr("dy",10).attr("dominant-baseline","hanging").style("opacity",0).text(function(t){return t[1]-t[0]<1?"":"Future"==t.data.year?"?":t[1]-t[0]}).transition().duration(1).delay(function(t,e){return 500+100*e}).style("opacity",function(t,e){return e>12&&!isMobile?1:0})}}function download_data(){d3.queue().defer(d3.csv,"data/women_mps.csv",function(t){var e=d3.timeParse("%Y-%m-%d");return{id:t.id,name:t.name,constituency:t.constituency,term_start:e(t.term_start),term_end:e(t.term_end),party:t.party,clean_name:t.clean_name,stream:+t.stream}}).defer(d3.csv,"data/number_women_over_time.csv",function(t){return{year:d3.timeParse("%Y-%m-%d")(t.Year),total_women_mps:+t.Total,conservative_women_mps:+t.Con,labour_women_mps:+t.Lab,lib_snp_women_mps:+t.Lib_SNP}}).defer(d3.csv,"data/total_mps_over_time.csv",function(t){return{year:d3.timeParse("%Y-%m-%d")(t.Year),total_mps:+t.total_mps,conservative_mps:+t.Con,labour_mps:+t.Lab,lib_snp_mps:+t.Lib_SNP}}).await(function(t,e,a,n){window.mps_over_time_data=e,window.number_women_over_time_data=a,window.total_mps_over_time_data=n;var o=d3.bisector(function(t){return t.year}).left;number_women_over_time_data.forEach(function(t){t.total_mps=total_mps_over_time_data[Math.max(0,o(total_mps_over_time_data,t.year)-1)].total_mps,t.women_pct=t.total_women_mps/t.total_mps*100,t.conservative_mps=total_mps_over_time_data[Math.max(0,o(total_mps_over_time_data,t.year)-1)].conservative_mps,t.conservative_women_pct=t.conservative_women_mps/t.conservative_mps*100,t.labour_mps=total_mps_over_time_data[Math.max(0,o(total_mps_over_time_data,t.year)-1)].labour_mps,t.labour_women_pct=t.labour_women_mps/t.labour_mps*100,t.lib_snp_mps=total_mps_over_time_data[Math.max(0,o(total_mps_over_time_data,t.year)-1)].lib_snp_mps,t.lib_snp_women_pct=t.lib_snp_women_mps/t.lib_snp_mps*100}),d3.select("#loading").remove(),draw_graph()}),d3.queue().defer(d3.csv,"data/mp_base64.csv",function(t){return{id:t.id,base64:t.base64}}).await(function(t,e){mp_base64_data={};for(var a=0;a<e.length;a++)mp_base64_data[e[a].id]=e[a].base64}),d3.queue().defer(d3.csv,"data/women_in_govt.csv",function(t){return{year:d3.timeParse("%Y-%m-%d")(t.date),women_pct:+t.women_parliament,country:t.country}}).defer(d3.csv,"data/baked_positions.csv").defer(d3.csv,"data/topic_medians.csv",function(t){return{topic:t.topic,male:Math.pow(10,+t.male),female:Math.pow(10,+t.female)}}).defer(d3.csv,"data/number_women_parliamentary_candidates_over_time.csv",function(t){return{year:t.Year,Labour:+t.Lab_women,Labour_total:+t.Lab_total,Conservative:+t.Con_women,Conservative_total:+t.Con_total,Liberal:+t.Lib_women,Liberal_total:+t.Lib_total,Other:+t.Other_women}}).defer(d3.csv,"data/photo_attribution.csv").await(function(t,e,a,n,o,i){women_in_govt_data=d3.nest().key(function(t){return t.country}).entries(e),topic_medians_data={},baked_positions_data=[],n.forEach(function(t){topic_medians_data[t.topic]={male:t.male,female:t.female}}),a.forEach(function(t){Object.keys(t).forEach(function(e){if("id"!=e&"full_name"!=e&"Constituency"!=e&"Party"!=e&"is_female"!=e&"y"!=e.slice(-1)){var a=e.slice(0,-2);baked_positions_data.push({id:+t.id,full_name:t.full_name,constituency:t.Constituency,party:t.Party,gender:1==t.is_female?"Female":"Male",search_string:(t.full_name+" "+t.Constituency+" "+t.Party+"-"+t.constituency).toLowerCase(),topic:a,x:+t[a+"_x"],y:+t[a+"_y"]/100})}})}),baked_positions_data=d3.nest().key(function(t){return t.topic}).entries(baked_positions_data),parliamentary_candidates_data=o,photo_attribution_data=i})}function getRetinaRatio(){var t=window.devicePixelRatio||1,e=document.createElement("canvas").getContext("2d");return t/[e.webkitBackingStorePixelRatio,e.mozBackingStorePixelRatio,e.msBackingStorePixelRatio,e.oBackingStorePixelRatio,e.backingStorePixelRatio,1].reduce(function(t,e){return t||e})}function handleContainerEnter(t){$graphic.classed("is-fixed",!0),$graphic.classed("is-bottom",!1)}function handleContainerExit(t){$graphic.classed("is-fixed",!1),$graphic.classed("is-bottom","down"===t.direction),"down"==t.direction&&lastTransitioned>=5&&(new_slide=7,update_state())}function mpZoom(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mid",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;zoom.on("zoom",zoomed);var i=mps_over_time_data.filter(function(e){return e.clean_name==t})[0];mouseover_svg.transition().duration(1e3).call(zoom.transform,d3.zoomIdentity.translate(width/2+o,height/2+n).scale(a).translate(-("mid"==e?(x(i.term_start)+x(i.term_end))/2:x(i.term_end)),-y(i.stream))).on("end",function(){d3.selectAll(".y-axis .tick").style("opacity",function(t){return t>=0?1:0})}),d3.select(tooltip).style("opacity",0),mouseover_svg.selectAll(".annotation-group").remove(),IGNORE_STATE=!0,mouseover_svg.select("line").datum(i).attr("x1",function(t){return x(t.term_start)}).attr("x2",function(t){return x(t.term_end)-1.2*lineThickness}).attr("y1",function(t){return y(t.stream)}).attr("y2",function(t){return y(t.stream)}).style("stroke-width",lineThickness).transition().delay(500).style("opacity",1)}function handleStepEnter(t){$step.classed("is-active",function(e,a){return a===t.index}),""!=d3.select(".is-active").node().innerText&&d3.select(".is-active").style("opacity",1).style("pointer-events","all"),d3.select("#tooltip").style("opacity",0),d3.selectAll(".annotation-group").remove(),window.addEventListener("scroll",function(){d3.select("#tooltip").style("opacity",0),mouseover_svg.selectAll(".annotation-group").remove()},{once:!0}),mouseover_svg.selectAll(".mp-annotation-group, .female-label, .male-label").remove(),new_slide=+$step.nodes()[t.index].getAttribute("data-slide"),update_state();var e=+$step.nodes()[t.index].getAttribute("data-step");try{if(e==+$step.nodes()[t.index+("down"==t.direction?-1:1)].getAttribute("data-step"))return}catch(t){}switch(current_slide){case 0:switch(mouseover_svg.select("line").style("opacity",0),e){case-1:"up"==t.direction&&electionRects.transition().delay(function(t,e){return 50*(electionRects.nodes().length-e)}).style("opacity",0);break;case 0:"up"==t.direction&&electionRects.filter(function(t,e){return 22==e}).classed("hover",!1).style("opacity",.35),electionRects.transition().delay(function(t,e){return 50*e}).style("opacity",.35);break;case.1:electionRects.filter(function(t,e){return 22==e}).classed("hover",!0).style("opacity",null);var a=d3.annotation().type(d3.annotationCallout).annotations([{note:{title:"New Labour landslide election",wrap:150},connector:{end:"dot"},x:x(new Date(1999,1,1)),y:y(100),dx:isMobile?-50:-100,dy:-200}]);wrapper.append("g").attr("class","annotation-group").call(a);break;case.2:"up"==t.direction&&(d3.select(".switch").style("opacity",0).style("display","none"),0!=document.getElementById("zoom-checkbox").checked&&document.getElementById("zoom-checkbox").click(),dataContainer.selectAll("custom.line").filter(function(t){return"margaretbeckett"!=t.clean_name}).transition().duration(1e3).attr("x2",function(t){return x(t.term_start)}).transition().duration(1e3).attr("y1",function(){return y(0)}).attr("y2",function(){return y(0)})),electionRects.filter(function(t,e){return 22==e}).classed("hover",!1).style("opacity",.35),dataContainer.selectAll("custom.line").filter(function(t){return"margaretbeckett"==t.clean_name}).transition().duration(1e3).attr("y1",function(t){return y(t.stream)}).attr("y2",function(t){return y(t.stream)}).transition().duration(1e3).attr("x2",function(t){return x(t.term_end)-1.2*lineThickness}).on("end",function(){show_mp_tooltip(mps_over_time_data.filter(function(t){return"margaretbeckett"==t.clean_name})[1])});var n=d3.timer(function(t){draw(context,!1),t>2e3&&(n.stop(),draw(context),draw(context_hidden,!0))});break;case.3:"down"==t.direction?(dataContainer.selectAll("custom.line").transition().delay(function(t,e){return 500+2*e}).duration(1e3).attr("y1",function(t){return y(t.stream)}).attr("y2",function(t){return y(t.stream)}).transition().delay(function(t,e){return 200+2*e}).duration(1e3).attr("x2",function(t){return x(t.term_end)-1.2*lineThickness}),all_mps_draw_timer=d3.timer(function(t){draw(context,!1),t>5e3&&(all_mps_draw_timer.stop(),draw(context),draw(context_hidden,!0),reset_zoom())})):mouseover_svg.transition().duration(1e3).call(zoom.transform,d3.zoomIdentity).on("end",function(){reset_zoom()}),canvas.style("pointer-events","auto"),d3.select(".switch").style("opacity",1).style("display","inline-block").on("mouseover",function(){d3.select("#tooltip").style("opacity",0),mouseover_svg.selectAll(".annotation-group").remove()}).select("#zoom-checkbox").on("change",function(){this.checked?(zoom.on("zoom",zoomed),canvas.call(zoom),d3.select(".is-active").style("opacity",0).style("pointer-events","none"),d3.select(".switch").select("label").text("STOP")):(reset_zoom(),d3.select(".is-active").filter(function(){return""!=this.innerText}).style("opacity",1).style("pointer-events","all"))});break;case 1:if(d3.select(".switch").style("opacity",0).style("display","none"),0!=document.getElementById("zoom-checkbox").checked){document.getElementById("zoom-checkbox").click(),d3.timeout(function(){try{all_mps_draw_timer.stop()}catch(t){}mpZoom("constancemarkievicz","mid",10,0,width/4)},1e3);var o=!0}else{try{all_mps_draw_timer.stop()}catch(t){}mpZoom("constancemarkievicz","mid",10,0,width/4)}annotate_timer=d3.timeout(function(){var t=mouseover_svg.select("line").node().getBoundingClientRect();a=d3.annotation().type(d3.annotationCallout).annotations([{note:{title:"Constance Markievicz"},x:t.x+t.width/2,y:t.y+t.height/2,dx:isMobile?30:100,dy:100}]),mouseover_svg.append("g").attr("class","mp-annotation-group").call(a)},o?2e3:1e3),canvas.style("pointer-events","none");break;case 2:mpZoom("nancyastor");try{annotate_timer.stop()}catch(t){}annotate_timer=d3.timeout(function(){var t=mouseover_svg.select("line").node().getBoundingClientRect();a=d3.annotation().type(d3.annotationCallout).annotations([{note:{title:"Nancy Astor"},x:t.x+t.width/2,y:t.y+t.height/2,dx:isMobile?30:100,dy:200}]),mouseover_svg.append("g").attr("class","mp-annotation-group").call(a)},1e3),canvas.style("pointer-events","none");break;case 4:mpZoom("margaretthatcher");try{annotate_timer.stop()}catch(t){}annotate_timer=d3.timeout(function(){var t=mouseover_svg.select("line").node().getBoundingClientRect();a=d3.annotation().type(d3.annotationCallout).annotations([{note:{title:"Margaret Thatcher"},x:t.x+t.width/2,y:t.y+t.height/2,dx:isMobile?30:100,dy:200}]),mouseover_svg.append("g").attr("class","mp-annotation-group").call(a)},1e3),canvas.style("pointer-events","none");break;case 5:try{annotate_timer.stop()}catch(t){}canvas.style("pointer-events","all"),d3.select(".switch").style("opacity",1).style("display","inline-block"),mouseover_svg.transition().duration(1e3).call(zoom.transform,d3.zoomIdentity).on("end",function(){d3.selectAll(".y-axis .tick").style("opacity",function(t){return t>=0?1:0}),electionRects.filter(function(t,e){return 22==e}).classed("hover",!1),mp_filter=mps_over_time_data.map(function(t){return t.clean_name}),dataContainer.selectAll("custom.line").transition().attr("strokeStyle",function(t){return colorParty(t.party)});var t=d3.timer(function(e){draw(context,!1),e>500&&(t.stop(),draw(context))})});break;case 6:if(d3.select(".switch").style("opacity",0).style("display","none"),0!=document.getElementById("zoom-checkbox").checked&&document.getElementById("zoom-checkbox").click(),canvas.style("pointer-events","all"),electionRects.filter(function(t,e){return 22==e}).classed("hover",!0),mp_filter=mps_over_time_data.filter(function(t){return t.term_start>=new Date(1997,4,1)&t.term_start<=new Date(1997,6,1)&"Lab"==t.party}).map(function(t){return t.clean_name}),"down"==t.direction){mouseover_svg.select("line").style("opacity",0);var i=mps_over_time_data.filter(function(t){return"louiseellman"==t.clean_name})[0];transform=d3.zoomIdentity.translate(3*width/4,3*height/5).scale(1.5).translate(-(x(i.term_start)+x(i.term_end))/2,-y(i.stream)),mouseover_svg.transition().duration(1e3).call(zoom.transform,d3.zoomIdentity).on("end",function(){d3.selectAll(".y-axis .tick").style("opacity",function(t){return t>=0?1:0})}).transition().call(zoom.transform,transform)}dataContainer.selectAll("custom.line").transition().delay("down"==t.direction?1e3:0).duration(500).attr("strokeStyle",function(t){return t.term_start>=new Date(1997,4,1)&t.term_start<=new Date(1997,6,1)&"Lab"==t.party?colorParty(t.party):hexToRGBA(colorParty(t.party),.2)}),"up"==t.direction&&(context.save(),context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),context.translate(transform.x,transform.y),context.scale(transform.k,transform.k)),n=d3.timer(function(e){draw(context,!1),e>500&&(n.stop(),draw(context),"up"==t.direction&&context.restore())});break;case 7:"up"==t.direction&&(d3.select(".switch").style("opacity",0).style("display","none"),0!=document.getElementById("zoom-checkbox").checked&&document.getElementById("zoom-checkbox").click()),mp_filter=["annebegg","judymallaber","sandraosborne","angelaesmith","giselastuart","annkeen","janetdean","chrismccafferty","juliemorgan","shonamcisaac","kalimountford","bettywilliams","lauramoffatt","lizblackman","mscandyatherton","dianaorgan","anncryer","gillianmerron","mariaeagle","louiseellman","margaretmoran","phyllisstarkey","geraldinesmith","sallykeeble","helenbrinton","lindagilroy","jackielawrence","jacquismith","karenbuck","fionamactaggart","annemcguire","daritaylor","debrashipley","melaniejohnson","jennyjones"],dataContainer.selectAll("custom.line").transition().duration(500).attr("strokeStyle",function(t){return t.term_start>=new Date(1997,4,1)&t.term_start<=new Date(1997,6,1)&"Lab"==t.party&-1!=mp_filter.indexOf(t.clean_name)?colorParty(t.party):hexToRGBA(colorParty(t.party),.2)}),"down"==t.direction&&(context.save(),context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),context.translate(transform.x,transform.y),context.scale(transform.k,transform.k)),n=d3.timer(function(t){draw(context,!1),t>500&&(n.stop(),draw(context),context.restore())});break;case 8:d3.select(".switch").style("opacity",1).style("display","inline-block"),"up"==t.direction&&draw(context,!1)}break;case 1:switch(d3.select(".switch").style("opacity",0),0!=document.getElementById("zoom-checkbox").checked&&document.getElementById("zoom-checkbox").click(),e){case 0:"up"==t.direction&&(yLabel.transition().text("Number of MPs"),chartTitle.transition().text("MPs in the House of Commons"),slide2Group.select(".party-label").transition().text(""),y.domain([0,750]),yAxis=d3.axisRight(y),gY.transition().call(yAxis),max_mps_line.y(function(t){return y(t.total_mps)}),max_mps_path.transition().attr("d",max_mps_line),max_mps_area.y1(function(t){return y(t.total_mps)}),max_mps_path_area.transition().attr("d",max_mps_area).style("fill",colors.Male),mask.transition().attr("d",max_mps_area),half_max_mps_line.y(function(t){return y(t.total_mps/2)}),half_max_mps_path.transition().attr("d",half_max_mps_line),half_max_mps_line_smooth.y(function(t){return y(isMobile?330:t.total_mps/2+1)}),text_path_50_50.transition().attr("d",half_max_mps_line_smooth),total_women_mps_line.y(function(t){return y(t.total_women_mps)}),total_women_mps_path.transition().attr("d",total_women_mps_line),total_women_mps_area.y1(function(t){return y(t.total_women_mps)}),total_women_mps_path_area.transition().attr("d",total_women_mps_area).style("opacity",1),d3.select(".women-label").style("fill",colors.Male).style("opacity",1));break;case 1:yLabel.transition().text("% of MPs"),chartTitle.transition().text("MPs in the Labour Party");try{slide2Group.select(".party-label").transition().text("Labour")}catch(t){}d3.selectAll("#timeline canvas").transition().duration(500).style("opacity",0).on("end",function(){context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),d3.select(this).style("display","none")}),y.domain([0,100]),yAxis=d3.axisRight(y).tickFormat(function(t){return t}),gY.transition().call(yAxis),max_mps_line.y(y(100)),max_mps_path.transition().attr("d",max_mps_line),max_mps_area.y1(y(100)),max_mps_path_area.transition().attr("d",max_mps_area).style("fill",colors.Labour).style("opacity",1),mask.transition().attr("d",max_mps_area),half_max_mps_line.y(y(50)),half_max_mps_path.transition().attr("d",half_max_mps_line),half_max_mps_line_smooth.y(y(51)),text_path_50_50.transition().attr("d",half_max_mps_line_smooth),total_women_mps_line.y(function(t){return y(t.labour_women_pct)}),total_women_mps_path.transition().attr("d",total_women_mps_line),total_women_mps_area.y1(function(t){return y(t.labour_women_pct)}),total_women_mps_path_area.transition().attr("d",total_women_mps_area).style("opacity",1),d3.select(".women-label").style("fill",colors.Labour).style("opacity",1),d3.select(".men-label").style("opacity",1),d3.select(".i5050-label").style("opacity",1);break;case 2:yLabel.transition().text("% of MPs"),chartTitle.transition().text("MPs in the Conservative Party");try{slide2Group.select(".party-label").transition().text("Conservative")}catch(t){}d3.selectAll("#timeline canvas").transition().duration(500).style("opacity",0).on("end",function(){context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),d3.select(this).style("display","none")}),y.domain([0,100]),yAxis=d3.axisRight(y).tickFormat(function(t){return t}),gY.transition().call(yAxis),max_mps_line.y(y(100)),max_mps_path.transition().attr("d",max_mps_line),max_mps_area.y1(y(100)),max_mps_path_area.transition().attr("d",max_mps_area).style("fill",colors.Conservative).style("opacity",1),mask.transition().attr("d",max_mps_area),half_max_mps_line.y(y(50)),half_max_mps_path.transition().attr("d",half_max_mps_line),half_max_mps_line_smooth.y(y(51)),text_path_50_50.transition().attr("d",half_max_mps_line_smooth),total_women_mps_line.y(function(t){return y(t.conservative_women_pct)}),total_women_mps_path.transition().attr("d",total_women_mps_line),total_women_mps_area.y1(function(t){return y(t.conservative_women_pct)}),total_women_mps_path_area.transition().attr("d",total_women_mps_area).style("opacity",1),d3.select(".women-label").style("fill",colors.Conservative).style("opacity",1);break;case 3:yLabel.transition().text("% of MPs"),chartTitle.transition().text(isMobile?"MPs in the Lib Dems and SNP":"MPs in the Liberal Democrats and Scottish National Party");try{slide2Group.select(".party-label").transition().text("Lib Dem/SNP")}catch(t){}d3.selectAll("#timeline canvas").transition().duration(500).style("opacity",0).on("end",function(){context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),d3.select(this).style("display","none")}),y.domain([0,100]),yAxis=d3.axisRight(y).tickFormat(function(t){return t}),gY.transition().call(yAxis),max_mps_line.y(y(100)),max_mps_path.transition().attr("d",max_mps_line),max_mps_area.y1(y(100)),max_mps_path_area.transition().attr("d",max_mps_area).style("fill",colors.LD).style("opacity",1),mask.transition().attr("d",max_mps_area),half_max_mps_line.y(y(50)),half_max_mps_path.transition().attr("d",half_max_mps_line),half_max_mps_line_smooth.y(y(51)),text_path_50_50.transition().attr("d",half_max_mps_line_smooth),total_women_mps_line.y(function(t){return y(t.lib_snp_women_pct)}),total_women_mps_path.transition().attr("d",total_women_mps_line),total_women_mps_area.y1(function(t){return y(t.lib_snp_women_pct)}),total_women_mps_path_area.transition().attr("d",total_women_mps_area).style("opacity",1),d3.select(".women-label").style("fill",colors.LD).style("opacity",1);break;case 4:yLabel.transition().text("% of MPs"),chartTitle.transition().text("MPs in the House of Commons");try{slide2Group.select(".party-label").transition().text("")}catch(t){}d3.selectAll("#timeline canvas").style("opacity",0).style("display","none"),context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),y.domain([0,100]),gY.transition().call(yAxis),max_mps_line.y(y(100)),max_mps_path.transition().attr("d",max_mps_line),max_mps_area.y1(y(100)),max_mps_path_area.transition().attr("d",max_mps_area).style("fill",colors.Male),mask.transition().attr("d",max_mps_area),half_max_mps_line.y(y(50)),half_max_mps_path.transition().attr("d",half_max_mps_line),half_max_mps_line_smooth.y(y(51)),text_path_50_50.transition().attr("d",half_max_mps_line_smooth),total_women_mps_line.y(function(t){return y(t.women_pct)}),total_women_mps_path.transition().attr("d",total_women_mps_line),total_women_mps_area.y1(function(t){return y(t.women_pct)}),total_women_mps_path_area.transition().attr("d",total_women_mps_area).style("opacity",1),d3.select(".women-label").style("fill",colors.Male).style("opacity",1)}break;case 3:d3.select("#slide4").style("display","none"),d3.select(".switch").style("opacity",0).style("display","none"),null!=document.getElementById("zoom-checkbox")&&0!=document.getElementById("zoom-checkbox").checked&&document.getElementById("zoom-checkbox").click(),chartTitle.transition().text("");break;case 4:d3.select("#slide4").style("display","none");try{annotate_timer.stop()}catch(t){}switch(e){case 0:update_fifth_slide(!1,"economy",!0,!1),chartTitle.transition().text("Time spent on the economy");break;case 1:update_fifth_slide(!1,"economy",!0,!0),chartTitle.transition().text("Time spent on the economy");break;case 2:update_fifth_slide(!1,"welfare reforms",!0,!0),chartTitle.transition().text("Time spent on welfare reforms");break;case 3:update_fifth_slide(!1,"parliamentary terminology",!0,!0),chartTitle.transition().text("Time spent on parliamentary terminology")}d3.select(".slide5-dropdown").style("display","none")}}function handleStepExit(t){d3.select("#tooltip").style("opacity",0);var e=+$step.nodes()[t.index].getAttribute("data-step");try{if(e==+$step.nodes()[t.index+("down"==t.direction?1:-1)].getAttribute("data-step"))return}catch(t){}switch(current_slide){case 0:switch(e){case.1:break;case.2:d3.select("#tooltip").style("opacity",0);break;case 7:"down"==t.direction&&(electionRects.filter(function(t,e){return 22==e}).classed("hover",!1),mouseover_svg.transition().duration(1e3).call(zoom.transform,d3.zoomIdentity).on("end",function(){d3.selectAll(".y-axis .tick").style("opacity",function(t){return t>=0?1:0}),mp_filter=mps_over_time_data.map(function(t){return t.clean_name}),dataContainer.selectAll("custom.line").transition().attr("strokeStyle",function(t){return colorParty(t.party)});var t=d3.timer(function(e){draw(context,!1),e>500&&(t.stop(),draw(context))})}))}break;case 3:switch(e){case 2:"up"==t.direction&&d3.select("#slide4").style("pointer-events","none").style("opacity",0);break;case 3:"down"==t.direction&&d3.select("#slide4").style("pointer-events","none").style("opacity",0)}}}function draw_graph(){margin={top:50,left:25,bottom:35,right:timeline.clientWidth<500?50:70};var t=timeline.clientWidth-margin.left-margin.right,e=timeline.clientHeight-margin.top-margin.bottom;t!=width|e!=height&&(isMobile=(width=t)<500,circleRadius=(lineThickness=.0018*(height=e)*2)/2,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+2*margin.bottom),mouseover_svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+2*margin.bottom),ratio=getRetinaRatio(),context.scale(ratio,ratio),context.translate(margin.left,margin.top),canvas.attr("width",ratio*(width+margin.left+margin.right)).attr("height",ratio*(height+margin.top+margin.bottom)).style("width",width+margin.left+margin.right+"px").style("height",height+margin.top+margin.bottom+"px"),context_hidden.scale(ratio,ratio),context_hidden.translate(margin.left,margin.top),canvas_hidden.attr("width",ratio*(width+margin.left+margin.right)).attr("height",ratio*(height+margin.top+margin.bottom)).style("width",width+margin.left+margin.right+"px").style("height",height+margin.top+margin.bottom+"px"),new_slide=0,current_slide=-1,initial_render(),first_slide())}var colors={Lab:"#C61148",Labour:"#C61148",Con:"#0096DB",Conservative:"#0096DB",SNP:"#FCCA46","Scottish National Party":"#FCCA46","Lib Dem":"#F37A48","Liberal Democrat":"#F37A48",Liberal:"#F37A48",LD:"#F37A48",Green:"#A1C181",SF:"#008e4b",Other:"#50514F",Male:"#7A47C6",Female:"#e5e5e5",Hover:"#e5e5e5",Active:"#A1C181"},party_abbreviations={Lab:"Labour Party",Lib:"Liberal Party",Con:"Conservative Party",LD:"Liberal Democrats",SNP:"Scottish National Party",UU:"Ulster Unionist Party",SF:"Sinn Féin",Ind:"Independent",SDP:"Social Democratic Party",SLDP:"SDLP",Green:"Green Party",PC:"Plaid Cymru",DU:"Democratic Unionist Party","Ind. Unity":"Independent"},new_slide=0,current_slide=-1,lastTransitioned=-1,scroller=scrollama(),$container=d3.select("#scroll"),$graphic=$container.select(".scroll__graphic"),$chart=$graphic.select(".chart"),$text=$container.select(".scroll__text"),$step=$text.selectAll(".step");window.onbeforeunload=function(){window.scrollTo(0,0)};var margin,ratio,clippedArea,electionRects,zoom,wrapper,transform,zoomedArea,pointsGroup,slide2Group,slide3Group,slide6Group,max_mps_line,max_mps_path,max_mps_area,max_mps_path_area,half_max_mps_line,half_max_mps_path,total_women_mps_line,total_women_mps_path,total_women_mps_area,total_women_mps_path_area,half_max_mps_line_smooth,text_path_50_50,women_in_govt_paths,mask,instance,x,y,chartTitle,credit_alink,xAxis,gX,xLabel,yAxis,gY,yLabel,tooltip,lineThickness,circleRadius,selected_topic,circle_male,circle_female,slide5_xScale,slide5_yScale,temp_nodes,mp_filter,isMobile,all_mps_draw_timer,annotate_timer,tooltip_timer,mps_over_time_data,number_women_over_time_data,total_mps_over_time_data,women_in_govt_data,mp_base64_data,topic_medians_data,baked_positions_data,parliamentary_candidates_data,photo_attribution_data,nodes_male,nodes_female,timeline=document.getElementById("timeline"),svg=d3.select(timeline).append("svg"),canvas=d3.select(timeline).append("canvas").attr("id","visible-canvas"),context=canvas.node().getContext("2d"),mouseover_svg=d3.select(timeline).append("svg").attr("id","mouseover-svg"),canvas_hidden=d3.select(document.createElement("canvas")),context_hidden=canvas_hidden.node().getContext("2d"),detachedContainer=document.createElement("custom"),dataContainer=d3.select(detachedContainer),width=0,height=0,partyHasLogo=Object.keys(colors),colourToNode={},initial_slide5=!0,IGNORE_STATE=!1;String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var nextCol=1;d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)})},download_data();