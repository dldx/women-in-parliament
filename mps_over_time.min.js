function colorParty(t){"use strict";return void 0!==colors[t]?colors[t]:colors.Other}function genColor(){var t=[];nextCol<16777215&&(t.push(255&nextCol),t.push((65280&nextCol)>>8),t.push((16711680&nextCol)>>16),nextCol+=1);return"rgb("+t.join(",")+")"}function hexToRGBA(t,e){var a=parseInt(t.slice(1,3),16),i=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16);return e?"rgba("+a+", "+i+", "+o+", "+e+")":"rgb("+a+", "+i+", "+o+")"}function formatDate(t){"use strict";var e=t.getMonth(),a=t.getFullYear();return["Jan","Feb","March","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][e]+" "+a}function reset_zoom(t,e){"use strict";mouseover_svg.select("#zoomed-area").selectAll("*").remove(),canvas.transition().duration(500).call(zoom.transform,d3.zoomIdentity).on("end",()=>{mouseover_svg.select("#zoomed-area").attr("transform",null),zoomedArea.attr("transform",null),zoom.on("zoom",null),canvas.on("wheel.zoom",null).on("wheel.zoom",null).on("mousedown.zoom",null).on("dblclick.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom touchcancel.zoom",null),yAxis=d3.axisLeft(y),gY=d3.select(".y-axis").call(yAxis),t(e)})}function update_state(){"use strict";current_slide!=new_slide&&(1==new_slide?reset_zoom(to_second_slide,current_slide):2==new_slide?reset_zoom(to_third_slide,current_slide):3==new_slide?reset_zoom(to_fourth_slide,current_slide):4==new_slide?(zoom.on("zoom",zoomed),to_fifth_slide(current_slide)):5==new_slide?reset_zoom(to_sixth_slide,current_slide):-1!=current_slide&0==new_slide&&(zoom.on("zoom",zoomed),to_first_slide(current_slide)),current_slide=new_slide),d3.selectAll(".arc").classed("c-1",function(t){return t.index%2==0}).classed("c-2",function(t){return t.index%2==1}).classed("active",function(t){return t.index==current_slide})}function initialise_tracker(){"use strict";d3.select(".tracker").remove();var t=d3.select("body").append("div").attr("class","tracker");t.append("button").attr("type","button").attr("class","nav-prev").text("Prev").on("click",function(){new_slide=Math.max(0,current_slide-1),update_state()});var e=t.append("svg").append("g").attr("class","tracker-wrapper").attr("transform","translate(30,30)");t.append("button").attr("type","button").attr("class","nav-next").text("Next").on("click",function(){new_slide=Math.min(tracker_data.length-1,current_slide+1),update_state()});var a=d3.pie().value(1),i=d3.arc().outerRadius(30).innerRadius(0),o=d3.arc().outerRadius(30).innerRadius(0),n=e.selectAll(".arc").data(a(tracker_data)).enter().append("g").attr("class","arc");n.append("path").attr("d",i),n.append("text").attr("transform",function(t){return"translate("+o.centroid(t)+")"}).text(function(t){return t.data.section}),n.on("mouseover",function(){d3.select(this).classed("hover",!0)}).on("mouseout",function(){d3.select(this).classed("hover",!1),update_state()}).on("click",function(t){new_slide=t.index,update_state()}),update_state();var r=Math.sqrt(3),s="m"+[[0,-1],[r/2,.5],[0,1],[-r/2,.5],[-r/2,-.5],[0,-1],[r/2,-.5]].map(function(t){return[30*t[0],30*t[1]].join(",")}).join("l")+"z";e.append("path").attr("class","tracker-hexagon").attr("d",s),e.append("clipPath").attr("id","hex-mask").append("path").attr("fill","none").attr("d",s),d3.select(".tracker-wrapper").attr("clip-path","url(#hex-mask)")}function initial_render(){"use strict";x=d3.scaleUtc().domain([new Date(1915,1,1),new Date(2020,1,1)]).range([0,width]),y=d3.scaleLinear().domain([0,210]).range([height,0]),svg.append("defs"),wrapper=svg.append("g").attr("class","timeline-wrapper").attr("transform","translate("+margin.left+","+margin.top+")"),mouseover_svg.append("g").attr("class","timeline-wrapper").attr("transform","translate("+margin.left+","+margin.top+")"),initialise_tracker(),d3.select("#tooltip").remove(),d3.select("body").append("div").attr("id","tooltip").attr("class","tooltip"),(tooltip=document.getElementById("tooltip")).innerHTML="<div style='padding: 2rem'>\n    You can hover on everything in this visualisation so go ahead and explore. Click the <em>Next</em> button when you're ready to continue.</div>",wrapper.append("rect").style("opacity",0).attr("width",width).attr("height",height),clippedArea=wrapper.append("g").attr("id","clippedArea").attr("clip-path","url(#clip)"),mouseover_svg.select(".timeline-wrapper").append("g").attr("id","clippedArea").attr("clip-path","url(#clip)"),zoomedArea=clippedArea.append("g").attr("id","zoomed-area"),mouseover_svg.select("#clippedArea").append("g").attr("id","zoomed-area"),wrapper.append("clipPath").attr("id","clip").append("rect").attr("width",width).attr("height",height),mouseover_svg.select(".timeline-wrapper").append("clipPath").attr("id","clip").append("rect").attr("width",width).attr("height",height),xAxis=d3.axisBottom(x),gX=wrapper.append("g").attr("class","x-axis").attr("transform","translate(0,"+height+")").call(xAxis),yAxis=d3.axisLeft(y),gY=wrapper.append("g").attr("class","y-axis").call(yAxis),xLabel=wrapper.append("text").attr("x",width/2).attr("y",height+margin.bottom/2).attr("class","x-label").text("Time"),yLabel=wrapper.append("text").attr("transform","rotate(-90)").attr("y",0-margin.left/2).attr("x",0-height/2).attr("class","y-label").text("Number of Women MPs"),zoom=d3.zoom().scaleExtent([.95,40]).on("zoom",zoomed)}function zoomed(t){"use strict";transform=t||d3.event.transform,0==current_slide&&(zoomedArea.attr("transform",transform),mouseover_svg.select("#zoomed-area").attr("transform",transform)),context.save(),context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),context.translate(transform.x,transform.y),context.scale(transform.k,transform.k),draw(context,!1),context.restore(),context_hidden.save(),context_hidden.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),context_hidden.translate(transform.x,transform.y),context_hidden.scale(transform.k,transform.k),draw(context_hidden,!0),context_hidden.restore(),0==current_slide|1==current_slide?gX.call(xAxis.scale(d3.event.transform.rescaleX(x))):4==current_slide?(gX.call(d3.axisBottom(d3.event.transform.rescaleX(slide5_xScale)).ticks(20)),draw_custom_labels()):d3.event.transform.rescaleX(x),0==current_slide|1==current_slide?gY.call(yAxis.scale(d3.event.transform.rescaleY(y))):d3.event.transform.rescaleY(y)}function add_election_rects(t=!0){d3.select("#election-rects").remove(),electionRects=zoomedArea.append("g").attr("id","election-rects").selectAll("rect").data(total_mps_over_time_data).enter().append("rect").style("opacity",t?.15:0).attr("class","election-rect").classed("c-1",function(t,e){return e%2==0}).classed("c-2",function(t,e){return e%2==1}).attr("x",function(t){return x(t.year)}).attr("y",y(800)).attr("width",function(t,e){var a=t.year,i=total_mps_over_time_data[Math.min(total_mps_over_time_data.length-1,e+1)].year;return x(i)-x(a)}).attr("height",y(0)-y(2e3))}function first_slide(t=!1){function e(){var t=d3.mouse(this);context_hidden.save();var e=context_hidden.getImageData(t[0]*ratio,t[1]*ratio,1,1).data;context_hidden.restore();var a="rgb("+e[0]+","+e[1]+","+e[2]+")",i=colourToNode[a];if(void 0!==i){if(Math.abs(y(i.stream)-(t[1]-margin.top))>2&&Math.abs(y(i.stream)-(t[1]-margin.top-transform.y)/transform.k)>2)return;if(-1==mp_filter.indexOf(i.clean_name))return;show_mp_tooltip(i,t)}d3.event.preventDefault()}d3.select("#slide1-group").remove(),d3.select("#election-rects").remove(),add_election_rects(t),pointsGroup=zoomedArea.append("g").attr("id","slide1-group"),(instance=dataContainer.selectAll("custom.line").data(mps_over_time_data)).attr("x2",t=>x(t.term_end)-1.2*lineThickness),mouseover_svg.select("#zoomed-area").selectAll("*").remove(),mouseover_svg.select("#zoomed-area").append("line"),0==t?instance.enter().append("custom").attr("class","line").attr("x1",t=>x(t.term_start)).attr("x2",t=>x(t.term_start)).attr("y1",()=>y(0)).attr("y2",()=>y(0)).attr("strokeStyle",t=>colorParty(t.party)).attr("hiddenStrokeStyle",function(t){return t.hiddenCol||(t.hiddenCol=genColor(),colourToNode[t.hiddenCol]=t),t.hiddenCol}):dataContainer.selectAll("custom.line").attr("x1",t=>x(t.term_start)).attr("y1",t=>y(t.stream)).attr("y2",t=>y(t.stream)).attr("x2",t=>x(t.term_end)-1.2*lineThickness),0==t&&(context.scale(ratio,ratio),context.translate(margin.left,margin.top),context.rect(0,0,width,height),context.clip(),context_hidden.scale(ratio,ratio),context_hidden.translate(margin.left,margin.top),context_hidden.rect(0,0,width,height),context_hidden.clip()),window.draw=function(t,e=!1){t.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),dataContainer.selectAll("custom.line").each(function(){let a=d3.select(this);t.beginPath(),t.lineWidth=e?1.3*lineThickness:lineThickness,t.strokeStyle=e?a.attr("hiddenStrokeStyle"):a.attr("strokeStyle"),e?(t.moveTo(a.attr("x1")-circleRadius,a.attr("y1")),t.lineTo(+a.attr("x2")+circleRadius,a.attr("y2"))):(t.lineCap="round",t.moveTo(a.attr("x1"),a.attr("y1")),t.lineTo(a.attr("x2"),a.attr("y2"))),t.stroke()})};var a=d3.timer(e=>{draw(context,!1),e>0|t&&(a.stop(),draw(context),draw(context_hidden,!0))});mp_filter=mps_over_time_data.map(t=>t.clean_name),canvas.on("mousemove",e).on("mouseout",()=>{d3.select(tooltip).transition().delay(3e3).style("opacity",0),0==IGNORE_STATE&&mouseover_svg.select("line").style("opacity",0)}).on("touchend",e),instance.exit().remove(),current_slide=0}function show_mp_tooltip(t,e){void 0===e&&(e=[3*width/4,3*height/4]),d3.select("#tooltip").style("opacity",1).style("transform",`translate(${Math.max(Math.min(e[0]-tooltip.offsetWidth/2,width-tooltip.offsetWidth-margin.right),0+margin.left)}px,${Math.max(Math.min(e[1]-tooltip.offsetHeight-20,height+tooltip.offsetHeight-20),margin.top)}px)`).style("pointer-events","none");var a=-1!=partyHasLogo.indexOf(t.party),i=`\n                    <h1 style="background-color: ${colorParty(t.party)};">${t.name}</h1>\n                    <div class="body-container">\n                <div class="mp-image-parent">`;void 0===mp_base64_data?i+=`<img class="mp-image-blurred" style="opacity: 0;"/>\n                <img class="mp-image" src="./mp-images/mp-${t.id}.jpg" />\n                `:void 0!==mp_base64_data[t.id]&&(i+=`<img class="mp-image-blurred" src="data:image/jpeg;base64, ${mp_base64_data[t.id]}"/>\n                <img class="mp-image" src="./mp-images/mp-${t.id}.jpg" style="opacity: ${void 0===t.loaded?0:t.loaded}${t.loaded=1};" onload="this.style.opacity = 1;" />\n                `),i+=`</div>\n            <div class="body">\n                    <div class="mp-term">${d3.timeFormat("%Y")(t.term_start)} &rarr;                     ${d3.timeFormat("%Y")(t.term_end)}</div>\n                    <div class="mp-constituency">${t.constituency}</div>\n                    </div>\n                    </div>\n                    <div class="mp-party" style="opacity: ${a?0:1}">${t.party}</div>\n                    ${a?`<img class="mp-party-logo" alt="${t.party} logo" style="opacity: ${a?1:0}" src="./party_logos/${t.party}.svg"/>`:""}\n                    `,tooltip.innerHTML=i,mouseover_svg.select("line").datum(t).attr("x1",t=>x(t.term_start)).attr("x2",t=>x(t.term_end)-1.2*lineThickness).attr("y1",t=>y(t.stream)).attr("y2",t=>y(t.stream)).style("stroke-width",lineThickness).style("opacity",1)}function to_first_slide(t){var e=svg.transition().duration(1e3);switch(yLabel.transition(e).text("Number of Women MPs"),t){case 1:e.select("#slide2-group").style("opacity",0).remove(),e.select("#info-bubbles").style("opacity",0).remove(),d3.selectAll(".election-rect").on("mouseover",null).on("mouseout",null);break;case 2:e.select("#slide2-group").style("opacity",0).remove(),e.select("#slide3-group").style("opacity",0).remove()}d3.select("#tooltip").style("opacity",0),d3.select("#visible-canvas").style("opacity",1).style("display",null),y.domain([0,210]),gY.transition().duration(1e3).call(yAxis),xAxis.scale(x.domain([new Date(1915,1,1),new Date(2020,1,1)])),gX.transition().duration(1e3).call(xAxis),pointsGroup.style("opacity",0),e.select("#slide1-group").style("opacity",1),canvas.style("pointer-events","all"),lastTransitioned<0?(lastTransitioned=0,first_slide(!1)):first_slide(!0)}function to_second_slide(t){"use strict";if(lastTransitioned<1)second_slide(!1),lastTransitioned=1;else{var e=svg.transition().duration(1e3);switch(yLabel.transition(e).text("Number of MPs"),t){case 0:e.select("#slide1-group").style("opacity",0).remove();break;case 2:e.select("#slide3-group").style("opacity",0).remove()}xAxis.scale(x.domain([new Date(1915,1,1),new Date(2020,1,1)])),gX.transition().duration(1e3).call(xAxis),add_election_rects(!0),second_slide(!0)}}function second_slide(t=!1){d3.select("#slide1-group").remove(),d3.select("#holding-div").remove(),d3.select("#slide2-group").remove(),slide2Group=zoomedArea.append("g").attr("id","slide2-group"),t&&slide2Group.style("opacity",0).transition().duration(1e3).style("opacity",1),max_mps_line=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.total_mps)}).curve(d3.curveCardinal),max_mps_path=slide2Group.append("path").attr("class","max-mps-path slide2").datum(total_mps_over_time_data).attr("stroke-width",1.5*lineThickness).attr("d",max_mps_line),max_mps_area=d3.area().curve(d3.curveCardinal).x(function(t){return x(t.year)}).y0(height).y1(function(t){return y(t.total_mps)}),max_mps_path_area=slide2Group.append("path").attr("class","max-mps-area slide2").data([total_mps_over_time_data]).attr("d",max_mps_area).style("opacity",0),mask=slide2Group.append("clipPath").attr("id","slide2-hover-mask").append("path").data([total_mps_over_time_data]).attr("d",max_mps_area),d3.select("#election-rects").attr("clip-path","url(#slide2-hover-mask)").moveToFront(),half_max_mps_line=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.total_mps/2)}).curve(d3.curveBasis),half_max_mps_path=slide2Group.append("path").attr("class","half-max-mps-path slide2").datum(total_mps_over_time_data).attr("stroke-width",1.5*lineThickness).attr("d",half_max_mps_line),total_women_mps_line=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.total_women_mps)}).curve(d3.curveBasis);(total_women_mps_path=slide2Group.append("path").attr("class","total-women-mps-path slide2").datum(number_women_over_time_data).attr("stroke-width",1.5*lineThickness).attr("d",total_women_mps_line)).node().getBoundingClientRect(),total_women_mps_area=d3.area().curve(d3.curveBasis).x(function(t){return x(t.year)}).y0(height).y1(function(t){return y(t.total_women_mps)}),total_women_mps_path_area=slide2Group.append("path").attr("class","total-women-mps-area slide2").data([number_women_over_time_data]).attr("d",total_women_mps_area).style("opacity",0),d3.select("#tooltip").style("opacity",0),mouseover_svg.select("line").style("opacity",0),canvas.style("pointer-events","none");var e=d3.bisector(function(t){return t.year}).left;if(0==t){dataContainer.selectAll("custom.line").transition().duration(500).attr("x2",function(t){return x(t.term_start)+circleRadius}).transition().duration(500).attr("y1",function(t){return y(number_women_over_time_data[e(number_women_over_time_data,t.term_start)].total_women_mps)}).attr("y2",function(t){return y(number_women_over_time_data[e(number_women_over_time_data,t.term_start)].total_women_mps)});var a=d3.timer(t=>{draw(context,!1),t>1e3&&a.stop()})}let i=d3.scaleLinear().domain([0,210]).range([height,0]),o=d3.line().x(function(t){return x(t.year)}).y(function(t){return i(t.total_women_mps)}).curve(d3.curveBasis).context(context);if(0==t){d3.timeout(()=>{context.lineWidth=1.5*lineThickness,context.strokeStyle="#CDCDCD"},1e3);const t=total_women_mps_path.node().getTotalLength();context.setLineDash([t]);const e=d3.easeCubic;let a=d3.timer(function(i){const n=e(i/3e3)*t;o(number_women_over_time_data),context.lineDashOffset=-(n+t),context.stroke(),i>3e3&&a.stop()},1e3)}d3.selectAll("#timeline canvas").transition().delay(t?100:4e3).duration(500).style("opacity",0).on("end",function(){context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),d3.select(this).style("display","none")}),total_women_mps_path_area.transition().delay(t?0:4e3).duration(t?0:750).attr("d",total_women_mps_area).style("opacity",1),y.domain([0,750]),yLabel.transition().delay(t?0:4e3).duration(t?0:750).text("Number of MPs"),slide2Group.append("text").attr("x",x(new Date(2010,1,1))).attr("y",y(0)-10*lineThickness).attr("font-size",Math.min(y(number_women_over_time_data.slice(-1)[0].total_women_mps)/4,(x(new Date(2020,1,1))-x(new Date(2e3,1,1)))/4)).attr("class","women-label").text("Women").style("opacity",0).transition().delay(t?0:4e3).duration(t?0:500).style("opacity",1),gY.transition().delay(t?0:5500).duration(t?1e3:750).call(yAxis),total_women_mps_path_area.transition().delay(t?0:5500).duration(t?0:750).attr("d",total_women_mps_area),total_women_mps_path.transition().delay(t?0:6250).duration(0).attr("d",total_women_mps_line).style("opacity",1),max_mps_path.transition().delay(t?0:6500).duration(t?0:750).attr("d",max_mps_line),max_mps_path_area.transition().delay(t?0:6500).duration(t?0:750).attr("d",max_mps_area).style("opacity",1),mask.transition().delay(t?0:6500).duration(t?0:750).attr("d",max_mps_area),half_max_mps_path.transition().delay(t?0:6500).duration(t?0:750).attr("d",half_max_mps_line),instance.on("mouseover",null).on("mouseout",null).on("click",null),svg.transition().delay(t?0:7e3).on("end",()=>{slide2Group.append("text").attr("x",x(new Date(2010,1,1))).attr("y",y(500)).attr("font-size",Math.min(y(number_women_over_time_data.slice(-1)[0].total_women_mps)/4,(x(new Date(2020,1,1))-x(new Date(2e3,1,1)))/4)).attr("class","men-label").text("Men").style("opacity",0).transition().duration(t?0:500).style("opacity",1),half_max_mps_line_smooth=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.total_mps/2)}).curve(d3.curveBundle.beta(.5)),text_path_50_50=slide2Group.append("defs").append("path").attr("id","half-max-textpath").datum(total_mps_over_time_data).attr("d",half_max_mps_line_smooth),slide2Group.append("text").append("textPath").attr("startOffset","50%").attr("xlink:href","#half-max-textpath").attr("font-size",Math.max(10*lineThickness,Math.min(20*lineThickness,(x(new Date(2020,1,1))-x(new Date(2e3,1,1)))/6))).attr("class","i5050-label").text("50:50 gender representation").style("opacity",0).transition().duration(t?0:500).style("opacity",1),electionRects.on("mouseover",function(t,a){var i=d3.mouse(this);d3.select("#tooltip").style("opacity",1).style("transform",`translate(${Math.max(Math.min(i[0]-tooltip.offsetWidth/2,width-tooltip.offsetWidth/2-margin.right),0+margin.left)}px,${Math.max(Math.min(i[1]-tooltip.offsetHeight-20,height+tooltip.offsetHeight-20),margin.top)}px)`).style("pointer-events","none"),d3.select(this).classed("hover",!0);var o=t.year,n=total_mps_over_time_data[Math.min(total_mps_over_time_data.length-1,a+1)].year,r=number_women_over_time_data[e(number_women_over_time_data,o)].total_women_mps,s=t.total_mps/r-1;tooltip.innerHTML=`<div class="slide2-tooltip"><h1>${formatDate(o)} &rarr; ${formatDate(n)}</h1>\n        ${r>0?`<p>${r} Wom${1==r?"a":"e"}n</p><hr/>\n            For every <span class="female">female</span> MP, there ${new Date>n?"were":"are"}\n                                <div class="gender-ratio">${s.toFixed(1)}</div> <span class="male">male</span> MPs.`:"There were no women in the House of Commons yet :("}\n                                </div>\n            `}).on("mouseout",function(){d3.select(this).classed("hover",!1)})})}function to_third_slide(t){"use strict";if(lastTransitioned<2)third_slide(!1),lastTransitioned=2;else{var e=svg.transition().duration(1e3);switch(t){case 0:e.select("#slide1-group").style("opacity",0).remove();break;case 3:d3.select("#slide4").transition(e).style("opacity",0).on("end",function(){this.remove()}),x=d3.scaleUtc().range([0,width]).domain([new Date(1990,1,1),new Date(2017,12,1)]),xAxis=d3.axisBottom(x),yAxis=d3.axisLeft(y).tickFormat(t=>t),xLabel.text("Time").style("opacity",1),yLabel.style("opacity",1),gX.call(xAxis).style("opacity",1),gY.call(yAxis).style("opacity",1),d3.select(".y-axis > path").style("opacity",1),d3.select("#slide2-group").style("opacity",1),d3.selectAll(".i5050-label").attr("startOffset","90%"),canvas.style("pointer-events","none")}third_slide(!0)}}function third_slide(t=!1){d3.select("#slide3-group").remove(),d3.select("#info-bubbles").remove(),slide3Group=zoomedArea.append("g").attr("id","slide3-group");var e=d3.transition().duration(t?500:1e3);y.domain([0,100]),gY.transition(e).call(yAxis),total_women_mps_line.y(t=>y(t.women_pct)),total_women_mps_path.transition(e).attr("d",total_women_mps_line),total_women_mps_area.y1(t=>y(t.women_pct)),total_women_mps_path_area.transition(e).attr("d",total_women_mps_area),max_mps_line.y(()=>y(100)),max_mps_path.transition(e).attr("d",max_mps_line),max_mps_area.y1(()=>y(100)),max_mps_path_area.transition(e).attr("d",max_mps_area),half_max_mps_line.y(()=>y(50)),half_max_mps_path.transition(e).attr("d",half_max_mps_line),half_max_mps_line_smooth.y(()=>y(50)),text_path_50_50.transition(e).attr("d",half_max_mps_line),mask.transition(e).attr("d",max_mps_area),yLabel.transition(e).text("% of Women MPs");var a=d3.scaleOrdinal(d3.schemeCategory20);xAxis.scale(x.domain([new Date(1990,1,1),new Date(2017,12,1)]));var i=e.transition().duration(t?500:1e3);gX.transition(i).call(xAxis),max_mps_path_area.transition(i).style("opacity",0).remove(),max_mps_path.transition(i).style("opacity",0).remove(),total_women_mps_path.transition(i).attr("d",total_women_mps_line),total_women_mps_path_area.transition(i).style("opacity",0).attr("d",total_women_mps_area).remove(),electionRects.transition(i).style("opacity",0).remove(),d3.selectAll(".women-label,.men-label").transition(i).style("opacity",0).remove();var o=d3.line().curve(d3.curveBasis).x(t=>x(t.year)).y(t=>y(t.women_pct));women_in_govt_data.filter(t=>"United Kingdom"==t.key)[0].values=number_women_over_time_data.map(t=>({year:t.year,women_pct:t.women_pct,country:"United Kingdom"})),women_in_govt_paths=slide3Group.selectAll(".women-in-govt-path").data(women_in_govt_data).enter().append("path").attr("d",function(t){return o(t.values)}).attr("class","women-in-govt-path").attr("id",t=>t.key.replace(/[^a-zA-Z0-9s]/g,"")).style("stroke",t=>"United Kingdom"==t.key?colors.Hover:a(t.key)).style("stroke-width",2*lineThickness).style("fill","none").style("opacity",1).attr("stroke-dasharray",function(){return this.getTotalLength()}).attr("stroke-dashoffset",function(){return this.getTotalLength()});var n=i.transition().duration(t?1e3:2e3);d3.select("#tooltip").style("transform","translate(50vw, 20vh)").style("transform-origin","50% 50%");var r=[];women_in_govt_paths.transition(n).delay((e,a)=>t?0:1200+1e3*a-100*Math.pow(a,1.5)).ease(d3.easeCubic).attr("stroke-dashoffset",0).style("opacity",t=>"United Kingdom"==t.key?1:.5).style("stroke-width",t=>"United Kingdom"==t.key?1.5*lineThickness:lineThickness/2).on("start",t=>{if(2==current_slide){d3.select("#tooltip").style("opacity",1);var e=100/t.values.slice(-1)[0].women_pct-1;tooltip.innerHTML=`\n                            <div class="slide3-tooltip">\n                                <h1 style="background-color: ${"United Kingdom"==t.values.slice(-1)[0].country?colors.Hover:a(t.values.slice(-1)[0].country)}">${t.values.slice(-1)[0].country}</h1>\n                                For every <span class="female">female</span> MP, there were\n                                <div class="gender-ratio">${e.toFixed(1)}</div> <span class="male">male</span> MPs in ${t.values.slice(-1)[0].year.getFullYear()}.\n                            </div>`}}).on("end",t=>{r.push(t.key),"United Kingdom"==t.key&&total_women_mps_path.remove()});var s=slide3Group.append("g").attr("transform","translate(-100,-100)").attr("class","focus");s.append("circle").attr("r",3.5),s.append("text").attr("y",-10);var l=slide3Group.append("g").attr("class","voronoi"),c=d3.voronoi().x(function(t){return x(t.year)}).y(function(t){return y(t.women_pct)}).extent([[-margin.left,-margin.top],[width+margin.right,height+margin.bottom]]);l.selectAll("path").data(c.polygons(d3.merge(women_in_govt_data.map(function(t){return t.values})))).enter().append("path").attr("d",function(t){return t?"M"+t.join("L")+"Z":null}).attr("fill","none").attr("pointer-events","all").on("mouseover",function(t){if(r.indexOf(t.data.country)>-1){var e=d3.mouse(this);d3.select("#tooltip").style("opacity",1).style("transform",`translate(${Math.max(Math.min(e[0]-tooltip.offsetWidth/2,width-tooltip.offsetWidth/2-margin.right),0+margin.left)}px,${Math.max(Math.min(e[1]-tooltip.offsetHeight-20,height+tooltip.offsetHeight-20),margin.top)}px)`).style("pointer-events","none");var i=100/t.data.women_pct-1;tooltip.innerHTML=`\n                            <div class="slide3-tooltip">\n                                <h1 style="background-color: ${"United Kingdom"==t.data.country?colors.Hover:a(t.data.country)};">${t.data.country}</h1>\n                                For every <span class="female">female</span> MP, there were\n                                <div class="gender-ratio">${i.toFixed(1)}</div> <span class="male">male</span> MPs in ${t.data.year.getFullYear()}.\n                            </div>`,t.line=d3.select("#"+t.data.country.replace(/[^a-zA-Z0-9s]/g,"")),t.line.style("stroke-width",t=>"United Kingdom"==t.key?2*lineThickness:lineThickness).style("opacity",1)}}).on("mouseout",function(t){r.indexOf(t.data.country)>-1&&t.line.style("stroke-width",t=>"United Kingdom"==t.key?1.5*lineThickness:lineThickness/2).style("opacity",t=>"United Kingdom"==t.key?1:.5)})}function to_fourth_slide(t){"use strict";lastTransitioned<3&&(lastTransitioned=3);var e=svg.transition().duration(1e3);switch(t){case 0:canvas.style("opacity",0).style("pointer-events","none");break;case 1:e.select("#slide2-group").style("opacity",0).remove();break;case 2:d3.select("#slide2-group").style("opacity",0),e.select("#slide3-group").style("opacity",0).remove();break;case 4:canvas.style("opacity",0).style("pointer-events","none"),mouseover_svg.select("circle").style("opacity",0),d3.selectAll("#floating-topic, .slide5-dropdown, .x-custom-axis").style("opacity",0).transition().delay(500).on("end",function(){this.remove()})}electionRects.transition(e).style("opacity",0).remove(),gX.transition(e).style("opacity",0),gY.transition(e).style("opacity",0),xLabel.transition(e).style("opacity",0),yLabel.transition(e).style("opacity",0),d3.select("#tooltip").transition(e).style("opacity",0).on("end",function(){fourth_slide(!1)})}function fourth_slide(){d3.select("#slide4").remove(),d3.select("body").append("div").attr("id","slide4").html(`<div class="slide4-tooltip"><h1 style='background-color: ${colors.Green};'>Topics mentioned in parliament by\n    <div id="slide4-mp-dropdown" class="ui inline dropdown search">\n    <div class="text"></div> <i class="dropdown icon"></i>\n  </div>\n</h1>\n    <div class="speech-flex-row">\n    <div class="mp-image-parent" id="slide4-mp-image">\n    </div>\n    <div class="mp-name-debate">\n    <div class="mp-name" id="slide4-mp-name"></div>\n    <div class="speech-debate" id="slide4-speech-debate"></div>\n    </div>\n    <button class="ui icon button" onclick="update_speech_tooltip()"><i class="random big icon"></i></button>\n    </div>\n    <p>\n    Below is the speech that <span id="slide4-name">Caroline Lucas</span> gave. You can see the topics the machine learning model identified at the bottom.\n    Click on the shuffle button on the right to try another speech, and on <span id="slide4-firstname">Caroline</span>'s name in the header bar to choose another MP.\n    </p>\n    <p class="blockquote" id="slide4-speech"></p>\n    <svg id="slide4-speech-topic-bar"></svg></div>`),d3.select("#slide4").style("pointer-events","none").style("opacity",0),topic_bar_width=document.querySelector("#slide4 > div > h1").offsetWidth,topic_bar_height=30,d3.select("#slide4-speech-topic-bar").attr("width",topic_bar_width).attr("height",topic_bar_height),$("#slide4-mp-dropdown").dropdown({values:speech_samples_data.map((t,e)=>({name:`<i class="${t.values[0].is_female?"female":"male"} fitted inverted grey icon" style="margin-right: 0.3rem !important"></i>`+t.key,value:e,selected:0==e})),fullTextSearch:!0}),$("#slide4-mp-dropdown").dropdown("set selected","0"),update_speech_tooltip(),$("#slide4-mp-dropdown").dropdown("setting","onChange",function(t){selected_mp!=t&&(selected_mp=t,update_speech_tooltip())})}function define_topic_scales(){"use strict";null==topicColorScale&&(topicColorScale=d3.scaleOrdinal(d3.schemeCategory20).domain([...new Set(speech_samples_data.map(t=>t.values.map(t=>Object.keys(t.topics)).reduce((t,e)=>t.concat(e))).reduce((t,e)=>t.concat(e)))])),null==topicBarScale&&(topicBarScale=d3.scaleLinear().domain([0,1])),topicBarScale.range([0,topic_bar_width])}function update_speech_tooltip(){"use strict";function t(t){for(var e=d3.select(this).text(t.key),a=topicBarScale(t[0][1])-topicBarScale(t[0][0]),i=!1;e.node().getComputedTextLength()>a&&!(a<=0);)e.text(e.text().slice(0,-1)),i=!0;i&&e.text(e.text().trim().slice(0,-2)+"...")}define_topic_scales();for(var e=speech_samples_data[selected_mp||0].values,a=e[Math.floor(Math.random()*e.length)],i=a;i==a;)a=e[Math.floor(Math.random()*e.length)];d3.select("#slide4-mp-image").html(`${void 0===mp_base64_data[a.mp_id]?"":'<img class="mp-image-blurred" src="data:image/jpeg;base64,'+mp_base64_data[a.mp_id]+'" /><img class="mp-image" src="./mp-images/mp-'+a.mp_id+'.jpg" style="opacity: ${typeof d.loaded == \'undefined\' ? 0 : d.loaded;d.loaded = 1;};" onload="this.style.opacity = 1;" />'}\n                `),d3.select("#slide4-mp-name").html(a.mp_name),d3.select("#slide4-speech-debate").html("on "+a.debate_title+" ("+new Date(a.date).toLocaleDateString("en-GB",{year:"numeric",month:"short"})+")"),d3.select("#slide4-speech").html(a.body),d3.select("#slide4-name").html(a.mp_name),d3.select("#slide4-firstname").html(a.mp_name.split(" ")[0]),a.topics.others=1-Object.entries(a.topics).filter(t=>"others"!=t[0]).map(t=>t[1]).reduce((t,e)=>t+e);var o=d3.stack().keys(Object.keys(a.topics))([a.topics]),n=d3.select("#slide4-speech-topic-bar").selectAll(".rect-fg").data(o);n.exit().transition().duration(1e3).attr("x",topicBarScale(1)).attr("height",topic_bar_height).style("opacity",0).remove(),n.attr("height",topic_bar_height).transition().style("opacity",1).attr("fill",t=>"others"==t.key?colors.Hover:topicColorScale(t.key)).attr("x",t=>topicBarScale(t[0][0])).attr("width",t=>topicBarScale(t[0][1])-topicBarScale(t[0][0])).attr("title",t=>`${t.key}: ${Math.round(Number(100*t[0].data[t.key]))}%`),n.enter().append("rect").attr("class","rect-fg").attr("fill",t=>"others"==t.key?colors.Hover:topicColorScale(t.key)).attr("x",topicBarScale(1)).attr("height",topic_bar_height).transition().style("opacity",1).attr("x",t=>topicBarScale(t[0][0])).attr("width",t=>topicBarScale(t[0][1])-topicBarScale(t[0][0])).attr("y",0).attr("title",t=>`${t.key}: ${Math.round(Number(100*t[0].data[t.key]))}%`);var r=d3.select("#slide4-speech-topic-bar").selectAll(".rect-label").data(o);r.exit().transition().duration(1e3).attr("x",topicBarScale(1)).style("opacity",0).remove(),r.transition().attr("x",t=>5+topicBarScale(t[0][0])).each(t),r.enter().append("text").attr("class","rect-label").attr("x",topicBarScale(1)).attr("alignment-baseline","middle").transition().attr("x",t=>5+topicBarScale(t[0][0])).attr("y",topic_bar_height/2).each(t),$(".rect-fg").popup({duration:100,position:"top right",transition:"fade",variation:"inverted"})}function to_fifth_slide(t){"use strict";var e=svg.transition().duration(1e3);switch(t){case 0:e.select("#slide1-group").style("opacity",0).remove();break;case 1:e.select("#slide2-group").style("opacity",0).remove();break;case 2:d3.select("#slide2-group").style("opacity",0),e.select("#slide3-group").style("opacity",0).remove();break;case 5:d3.select("#slide6-group").style("opacity",0),d3.selectAll(".x-custom-label").style("opacity",0).on("end",()=>{d3.selectAll(".x-custom-label").remove()})}d3.select("#tooltip").transition(e).style("opacity",0).on("end",function(){this.innerHTML=""}),electionRects.transition(e).style("opacity",0).on("end",function(){this.remove()}),gX.style("opacity",0),gY.style("opacity",0),xLabel.style("opacity",0),yLabel.style("opacity",0),lastTransitioned<4?(lastTransitioned=4,fifth_slide(!1)):fifth_slide(!0)}function fifth_slide(t=!1){d3.select("#topic-dropdown").remove(),d3.selectAll(".slide5-dropdown").remove(),d3.select("#floating-topic").remove(),wrapper.select(".x-custom-axis").remove(),wrapper.append("g").attr("class","x-custom-axis").attr("transform","translate(0,"+height+")"),mouseover_svg.select("#zoomed-area").selectAll("*").remove(),mouseover_svg.select("#zoomed-area").append("circle");try{var e=d3.select("#slide4-speech-topic-bar > .rect-fg").node().getBoundingClientRect();d3.select("body").append("svg").attr("id","floating-topic").style("top",0).style("left",0).style("position","fixed").style("transform",`translate(${e.x}px, ${e.y}px) translateZ(0)`).style("transition","transform 1s ease-in-out 1s, opacity 1s ease-in-out").style("opacity",t?0:1).node().appendChild(d3.select("#slide4-speech-topic-bar > .rect-fg").node().cloneNode()).parentNode.appendChild(d3.select("#slide4-speech-topic-bar > .rect-label").node().cloneNode()),d3.select("#slide4").style("opacity",0).transition().duration(1e3).on("end",function(){this.remove()}),d3.select("#floating-topic").attr("width",e.width).transition().delay(1e3).duration(1e3).attr("width",width/2),d3.select("#floating-topic > .rect-label").html(function(){return selected_topic=this.parentElement.getElementsByClassName("rect-fg")[0].getAttribute("title").split(":")[0]}),d3.timeout(()=>{d3.select("#floating-topic").style("transform",`translate(${width/4}px, ${2*margin.top}px)`).transition().delay(1e3).style("fill","white").select(".rect-fg").style("opacity",0)},1e3)}catch(t){lastTransitioned<5&&d3.select("body").append("svg").attr("id","floating-topic").style("top",0).style("left",0).style("position","absolute").style("transform",`translate(${width/4+20}px, ${2*margin.top+10}px) translateZ(0)`).style("transition"," opacity 1s ease-in-out").append("text").attr("class","rect-label").attr("alignment-baseline","middle").attr("x",5).attr("y",15).style("fill","white").html(selected_topic)}d3.timeout(()=>{d3.select("#visible-canvas").style("opacity",1).style("display",null).style("pointer-events","all"),lastTransitioned>4&&(d3.select("body").insert("select",":first-child").attr("id","topic-dropdown").on("change",update_fifth_slide).selectAll(".topic").data(baked_positions_data.map(t=>t.key)).enter().append("option").attr("selected",t=>t==selected_topic?"selected":null).attr("value",t=>t).text(t=>t.toUpperCase()),$("#topic-dropdown").dropdown(),d3.select("#topic-dropdown").node().parentNode.className+=" slide5-dropdown",d3.select(".slide5-dropdown").style("transform",`translate(${width/4}px, ${2*margin.top}px)`)),slide5_xScale=d3.scaleLinear().domain([-300,150]).range([0,width+margin.left+margin.right]),slide5_yScale=d3.scaleLinear().domain([0,.3]).range([height,0]),y=slide5_yScale,d3.select("#slide5-group").remove(),update_fifth_slide(t)},t?500:3e3)}function update_fifth_slide(t){function e(){var t=d3.mouse(this);if(nodeData=void 0!==transform?quadtree.find((t[0]-margin.left-transform.x)/transform.k,(t[1]-margin.top-transform.y)/transform.k,50):quadtree.find(t[0]-margin.left,t[1]-margin.top,50),"undefined"!=typeof nodeData)if(void 0!==nodeData.id){d3.select("#tooltip").style("opacity",1).style("transform",`translate(${Math.max(Math.min(t[0]-tooltip.offsetWidth/2,width-tooltip.offsetWidth-margin.right),0+margin.left)}px,${Math.max(Math.min(t[1]-tooltip.offsetHeight-20,height+tooltip.offsetHeight-20),margin.top)}px)`).style("pointer-events","none");var e=-1!=partyHasLogo.indexOf(nodeData.party);tooltip.innerHTML=`\n                            <div class="slide5-tooltip">\n                    <h1 style="background-color: ${colorParty(nodeData.party)};">${nodeData.full_name}</h1>\n                    <div class="body-container">\n                    <div class="mp-image-parent">\n                    ${void 0===mp_base64_data[nodeData.id]?"":'<img class="mp-image-blurred" src="data:image/jpeg;base64,'+mp_base64_data[nodeData.id]+'" /><img class="mp-image" src="./mp-images/mp-'+nodeData.id+'.jpg" style="opacity: ${typeof nodeData.loaded == \'undefined\' ? 0 : nodeData.loaded;d.loaded = 1;};" onload="this.style.opacity = 1;" />'}\n                    </div>\n                    <p class="body">${(100*nodeData[selected_topic]).toFixed(2)}% of ${nodeData.full_name}'s time spent on ${selected_topic}</p>\n                    </div>\n                    <div class="mp-party" style="opacity: ${e?0:1}">${nodeData.party}</div>\n                    ${e?`<img class="mp-party-logo" alt="${nodeData.party} logo" style="opacity: ${e?1:0}" src="./party_logos/${nodeData.party}.svg"/>`:""}\n</div>`,mouseover_svg.select("circle").datum(nodeData).attr("cx",t=>t.x).attr("cy",t=>t.y).attr("r",4.8).style("opacity",1).style("stroke-width",2)}else!function(t,e){d3.select("#tooltip").style("opacity",1).style("transform",`translate(${Math.max(Math.min(e[0]-tooltip.offsetWidth/2,width-tooltip.offsetWidth/2-margin.right),0+margin.left)}px,${Math.max(Math.min(e[1]-tooltip.offsetHeight-20,height+tooltip.offsetHeight-20),margin.top)}px)`).style("pointer-events","none"),tooltip.innerHTML=`\n                            <div class="slide5-tooltip">\n                    <h1 style="background-color: ${"female"==t.gender?colors.Hover:colors.Lab};">${t.gender.capitalize()}</h1>\n                    The average ${t.gender.capitalize()} MP spends ${(100*t.median).toFixed(1)}% of ${"male"==t.gender?"his":"her"} time talking about ${selected_topic}.\n</div>`,mouseover_svg.select("circle").datum(t).attr("cx",t=>t.x).attr("cy",t=>t.y).attr("r",6).style("opacity",1).style("stroke-width",2)}(nodeData,t);d3.event.preventDefault()}mouseover_svg.select("circle").style("opacity",0);try{selected_topic=d3.select("#topic-dropdown").property("value")}catch(t){let e=Object.keys(topic_medians_data);selected_topic=selected_topic||e[Math.floor(Math.random()*e.length)]}d3.select("#floating-topic > .rect-label").html(selected_topic);var a=baked_positions_data.filter(t=>t.key==selected_topic)[0].values;nodes_male.map(function(t){var e=a.filter(e=>e.id==t.id)[0];t.x=slide5_xScale(e.x)-10,t.y=slide5_yScale(e.y)}),nodes_female.map(function(t){var e=a.filter(e=>e.id==t.id)[0];t.x=slide5_xScale(e.x)+10,t.y=slide5_yScale(e.y)});var i=[];i.push({x:slide5_xScale(0),y:slide5_yScale(topic_medians_data[selected_topic].female),median:topic_medians_data[selected_topic].female,gender:"female"}),i.push({x:slide5_xScale(0),y:slide5_yScale(topic_medians_data[selected_topic].male),median:topic_medians_data[selected_topic].male,gender:"male"}),quadtree=d3.quadtree().extent([[-1,-1],[width+1,height+1]]).x(t=>t.x).y(t=>t.y).addAll(nodes_male).addAll(nodes_female).addAll(i);var o=d3.transition().duration(3e3),n=o.transition().delay(t?1e3:2e3).duration(1e3);(circle_male=dataContainer.selectAll(".male-node").data(nodes_male)).transition(o).attr("cx",t=>t.x).attr("cy",t=>t.y),circle_male.enter().append("custom").attr("class","male-node").attr("r",1.8).attr("cx",e=>t?e.x:slide5_xScale(0)).attr("cy",t=>t.y).attr("opacity",0).transition(o).delay((e,a)=>t?0:100*Math.sqrt(a)).attr("opacity",.7).attr("cx",t=>t.x).attr("cy",t=>t.y),(circle_female=dataContainer.selectAll(".female-node").data(nodes_female)).transition(o).attr("cx",t=>t.x).attr("cy",t=>t.y),circle_female.enter().append("custom").attr("class","female-node").attr("cx",t=>t.x).attr("cy",t=>t.y).attr("r",1.8).attr("cx",e=>t?e.x:slide5_xScale(0)).attr("cy",t=>t.y).attr("opacity",0).transition(o).delay((e,a)=>t?0:100*Math.sqrt(a)).attr("opacity",.7).attr("cx",t=>t.x).attr("cy",t=>t.y);var r=dataContainer.selectAll(".median-connector").data([topic_medians_data[selected_topic]]);r.transition(o).attr("y1",t=>slide5_yScale(t.female)).attr("y2",t=>slide5_yScale(t.male)),r.enter().append("custom").attr("class","median-connector").attr("x1",slide5_xScale(0)).attr("x2",slide5_xScale(0)).transition(n).attr("y1",t=>slide5_yScale(t.female)).attr("y2",t=>slide5_yScale(t.male));var s=dataContainer.selectAll(".male-median").data([topic_medians_data[selected_topic].male]);s.transition(o).attr("cy",t=>slide5_yScale(t)),s.enter().append("custom").attr("class","male-median").attr("cx",slide5_xScale(0)).attr("cy",slide5_yScale(0)).attr("r",3).attr("opacity",0).transition(n).attr("opacity",1).attr("cy",t=>slide5_yScale(t));var l=dataContainer.selectAll(".female-median").data([topic_medians_data[selected_topic].female]);l.transition(o).attr("cy",t=>slide5_yScale(t)),l.enter().append("custom").attr("class","female-median").attr("cx",slide5_xScale(0)).attr("cy",slide5_yScale(0)).attr("r",3).attr("opacity",0).transition(n).attr("opacity",1).attr("cy",t=>slide5_yScale(t)),context_hidden.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),window.draw=function(t){t.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),dataContainer.selectAll("custom.male-node").each(function(){let e=d3.select(this);t.fillStyle=hexToRGBA(colors.Lab,e.attr("opacity")),t.beginPath(),t.arc(e.attr("cx"),e.attr("cy"),e.attr("r"),0,2*Math.PI),t.fill()}),dataContainer.selectAll("custom.female-node").each(function(){let e=d3.select(this);t.fillStyle=hexToRGBA(colors.Hover,e.attr("opacity")),t.beginPath(),t.arc(e.attr("cx"),e.attr("cy"),e.attr("r"),0,2*Math.PI),t.fill()}),dataContainer.select("custom.median-connector").each(function(){let e=d3.select(this);t.beginPath(),t.lineWidth=1,t.strokeStyle="white",t.moveTo(e.attr("x1"),e.attr("y1")),t.lineTo(+e.attr("x2"),e.attr("y2")),t.stroke()}),dataContainer.select("custom.male-median").each(function(){let e=d3.select(this);t.fillStyle=hexToRGBA(colors.Lab,e.attr("opacity")),t.beginPath(),t.arc(e.attr("cx"),e.attr("cy"),e.attr("r"),0,2*Math.PI),t.fill()}),dataContainer.select("custom.female-median").each(function(){let e=d3.select(this);t.fillStyle=hexToRGBA(colors.Hover,e.attr("opacity")),t.beginPath(),t.arc(e.attr("cx"),e.attr("cy"),e.attr("r"),0,2*Math.PI),t.fill()})};var c=d3.timer(t=>{draw(context,!1),initial_slide5&t>5e3|1!=initial_slide5&t>1e3&&(c.stop(),draw(context),initial_slide5=!1)});window.draw_custom_labels=function(){let t=d3.selectAll(".x-axis text").nodes(),e=t[t.map(t=>+t.textContent).indexOf(8)];void 0===e&&(e=t.filter(t=>+t.textContent>0)[0]);let a=t[t.map(t=>+t.textContent).indexOf(-8)];void 0===a&&(a=(a=t.filter(t=>+t.textContent<0))[a.length-1]),wrapper.select(".x-custom-axis").selectAll("*").remove(),void 0!==a&&wrapper.select(".x-custom-axis").append("text").attr("class","x-label x-custom-label").attr("transform",a.parentNode.getAttribute("transform")).attr("dy",10).style("text-anchor","end").style("fill",colors.Lab).html("Men"),void 0!==e&&wrapper.select(".x-custom-axis").append("text").attr("class","x-label x-custom-label").attr("transform",e.parentNode.getAttribute("transform")).attr("dy",10).style("text-anchor","start").style("fill",colors.Hover).html("Women")},gX.call(d3.axisBottom(slide5_xScale).ticks(20)),draw_custom_labels(),canvas.on("mousemove",e).on("drag",e).on("touchend",e),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}function to_sixth_slide(t){"use strict";var e=svg.transition().duration(1e3);switch(t){case 0:e.select("#slide1-group").style("opacity",0).remove();break;case 1:d3.select("#slide2-group").style("opacity",0);break;case 2:d3.select("#slide2-group").style("opacity",0),e.select("#slide3-group").style("opacity",0).on("end",function(){this.remove()});break;case 3:d3.select("#slide4").style("opacity",0).transition().delay(1e3).on("end",function(){this.remove()});break;case 4:d3.selectAll("#floating-topic, .slide5-dropdown, .x-custom-axis").style("opacity",0).transition().delay(1e3).on("end",function(){this.remove()})}d3.select("#tooltip").transition(e).style("opacity",0).on("end",function(){this.innerHTML=""}),electionRects.transition(e).style("opacity",0).remove(),lastTransitioned<5?(x=d3.scaleLinear().range([0,width]).domain([0,.05]),xAxis=d3.axisBottom(x).tickFormat(t=>(100*t).toFixed(1)+"%")):(x=d3.scaleLinear().range([0,width]).domain([-.04,.04]),xAxis=d3.axisBottom(x).tickFormat(t=>(100*t).toFixed(0)+"%")),gX.transition().call(xAxis),y=d3.scalePoint().range([height,0]).padding(1),lastTransitioned<5?e.on("end",()=>{sixth_slide(!1),lastTransitioned=5}):e.on("end",()=>sixth_slide(!0))}function sixth_slide(t=!1){0==(t=lastTransitioned>=5)&&(d3.select("#slide6-group").remove(),slide6Group=zoomedArea.append("g").attr("id","slide6-group")),canvas.style("opacity",0).style("display",null).style("pointer-events","none"),mouseover_svg.select("circle").style("opacity",0),d3.select("#topic-dropdown").style("opacity",0).remove();let e=Object.entries(topic_medians_data).sort((t,e)=>t[1].female-t[1].male-(e[1].female-e[1].male));y.domain(e.map(t=>t[0])),yAxis=d3.axisLeft(y),gY.transition().call(yAxis),d3.select(".y-axis > path").style("opacity",0),d3.selectAll(".y-axis > .tick line").style("opacity",0);var a=d3.transition().duration(1e3);if(d3.selectAll(".y-axis > .tick text").style("text-transform","uppercase"),4==lastTransitioned){d3.selectAll(".y-axis > .tick text").style("opacity",t=>t==selected_topic?1:0);(i=slide6Group.selectAll(".median-connector").data([topic_medians_data[selected_topic]])).enter().append("line").attr("class","median-connector tmp").attr("stroke-width",1).attr("x1",slide5_xScale(0)).attr("x2",slide5_xScale(0)).attr("y1",t=>slide5_yScale(t.female)).attr("y2",t=>slide5_yScale(t.male)).transition(a).attr("x1",t=>x(t.female)).attr("x2",t=>x(t.male)).attr("y1",y(selected_topic)).attr("y2",y(selected_topic));(o=slide6Group.selectAll(".male-median").data([topic_medians_data[selected_topic].male])).enter().append("circle").attr("class","male-median tmp").attr("cx",slide5_xScale(0)).attr("cy",t=>slide5_yScale(t)).attr("r",3).transition(a).attr("cx",t=>x(t)).attr("cy",y(selected_topic));(n=slide6Group.selectAll(".female-median").data([topic_medians_data[selected_topic].female])).enter().append("circle").attr("class","female-median tmp").attr("cx",slide5_xScale(0)).attr("cy",t=>slide5_yScale(t)).attr("r",3).transition(a).attr("cx",t=>x(t)).attr("cy",y(selected_topic)).on("end",()=>{gX.style("opacity",1),gY.style("opacity",1),xLabel.text("Average % of time spent on topic").style("opacity",1)})}else{var i=slide6Group.selectAll(".median-connector").data(e),o=slide6Group.selectAll(".male-median").data(e),n=slide6Group.selectAll(".female-median").data(e);xLabel.text("Average % of time spent on topic").style("opacity",1),gX.style("opacity",1),gY.style("opacity",1),yLabel.style("opacity",0)}var r=a.transition().duration(500);if(0==t){i.data(e).enter().append("line").attr("class",(t,e)=>"median-connector topic-"+e).attr("stroke-width",1).attr("x1",x(0)).attr("x2",x(0)).attr("y1",t=>y(t[0])).attr("y2",t=>y(t[0])).attr("opacity",0).transition(r).delay((t,e)=>1e3+50*e).attr("opacity",t=>t[0]==selected_topic?0:1).attr("x1",t=>x(t[1].female)).attr("x2",t=>x(t[1].male)),o.data(e).enter().append("circle").attr("class",(t,e)=>"male-median topic-"+e).attr("r",3).attr("cx",x(0)).attr("cy",t=>y(t[0])).attr("opacity",0).transition(r).delay((t,e)=>1e3+50*e).attr("opacity",t=>t[0]==selected_topic?0:1).attr("cx",t=>x(t[1].male)),n.data(e).enter().append("circle").attr("class",(t,e)=>"female-median topic-"+e).attr("r",3).attr("cx",x(0)).attr("cy",t=>y(t[0])).attr("opacity",0).transition(r).delay((t,e)=>1e3+50*e).attr("opacity",t=>t[0]==selected_topic?0:1).attr("cx",t=>x(t[1].female));var s=r.transition().delay(3400).on("end",()=>{slide6Group.selectAll(".topic-"+e.map(t=>t[0]).indexOf(selected_topic)).attr("opacity",1),slide6Group.selectAll(".tmp").remove(),d3.selectAll(".y-axis > .tick text").style("opacity",1).style("transition","opacity 0.2s ease-in-out")});slide6Group.selectAll(".hover-rect").data(e).enter().append("rect").attr("class","hover-rect").attr("x",x(0)).attr("y",t=>y(t[0])-y.step()/2).attr("width",width).attr("height",y.step()).on("mouseover",(t,e)=>{slide6Group.selectAll("circle.topic-"+e).attr("r",6),slide6Group.select("line.topic-"+e).attr("stroke-width",3)}).on("mouseout",(t,e)=>{slide6Group.selectAll("circle.topic-"+e).attr("r",3),slide6Group.select("line.topic-"+e).attr("stroke-width",1)}).on("click",t=>{selected_topic=t[0],new_slide=4,update_state()});var l=s.transition().delay(1e3).on("end",()=>{x.domain([-.04,.04]),xAxis=d3.axisBottom(x).tickFormat(t=>(100*t).toFixed(0)+"%"),gX.transition().call(xAxis).on("end",()=>{var t=d3.transition().duration(1e3);slide6Group.selectAll(".median-connector").transition(t).delay((t,e)=>50*e).attr("x1",t=>x(t[1].female-t[1].male)).attr("x2",x(0)),slide6Group.selectAll(".female-median").transition(t).delay((t,e)=>50*e).attr("cx",t=>x(t[1].female-t[1].male>0?t[1].female-t[1].male:0)),slide6Group.selectAll(".male-median").transition(t).delay((t,e)=>50*e).attr("cx",t=>x(t[1].female-t[1].male<0?t[1].female-t[1].male:0)).on("end",()=>d3.selectAll(".y-axis > .tick text").style("opacity",0)),xLabel.text("Median female - Median male"),wrapper.append("text").attr("class","x-custom-label").attr("x",width-margin.right).attr("y",height+margin.bottom/2).text("FEMALE FRIENDLY").style("text-anchor","middle").style("fill",colors.Hover).style("alignment-baseline","hanging"),wrapper.append("text").attr("class","x-custom-label").attr("x",margin.left).attr("y",height+margin.bottom/2).text("MALE FRIENDLY").style("text-anchor","end").style("fill",colors.Lab).style("alignment-baseline","hanging")})}).transition()}else slide6Group.selectAll(".median-connector").attr("x1",t=>x(t[1].female-t[1].male)).attr("x2",x(0)),slide6Group.selectAll(".female-median").attr("cx",t=>x(t[1].female-t[1].male>0?t[1].female-t[1].male:0)),slide6Group.selectAll(".male-median").attr("cx",t=>x(t[1].female-t[1].male<0?t[1].female-t[1].male:0)),l=d3.transition().on("end",()=>{slide6Group.style("opacity",1)}),wrapper.append("text").attr("class","x-custom-label").attr("x",width-margin.right).attr("y",height+margin.bottom/2).text("FEMALE FRIENDLY").style("text-anchor","middle").style("fill",colors.Hover).style("alignment-baseline","hanging"),wrapper.append("text").attr("class","x-custom-label").attr("x",margin.left).attr("y",height+margin.bottom/2).text("MALE FRIENDLY").style("text-anchor","end").style("fill",colors.Lab).style("alignment-baseline","hanging");let c=e.map(t=>t[1].female-t[1].male>0);d3.selectAll(".y-axis > .tick text").filter(t=>-1!=Object.keys(topic_medians_data).indexOf(t)).transition(l).delay(()=>t?0:3e3).duration(t?1:1e3).style("text-anchor",(t,e)=>c[e]?"end":"start").attr("x",(t,e)=>c[e]?x.domain([-.04,.04])(-.001):x.domain([-.04,.04])(.001)).transition().delay(500).duration(500).style("opacity",1)}function download_data(){d3.queue().defer(d3.csv,"women_mps.csv",function(t){var e=d3.timeParse("%Y-%m-%d");return{id:t.id,name:t.name,constituency:t.constituency,term_start:e(t.term_start),term_end:e(t.term_end),party:t.party,byelection:"TRUE"==t.byelection,notes:t.notes,clean_name:t.clean_name,stream:+t.stream}}).defer(d3.csv,"number_women_over_time.csv",function(t){return{year:d3.timeParse("%Y-%m-%d")(t.Year),total_women_mps:+t.Total,total_mps:+t.total_mps}}).defer(d3.csv,"total_mps_over_time.csv",function(t){return{year:d3.timeParse("%Y-%m-%d")(t.Year),total_mps:+t.total_mps}}).defer(d3.json,"info_bubbles.json").await(function(t,e,a,i,o){window.mps_over_time_data=e,window.number_women_over_time_data=a,window.total_mps_over_time_data=i;var n=d3.bisector(function(t){return t.year}).left;number_women_over_time_data.forEach(t=>{t.total_mps=total_mps_over_time_data[Math.max(0,n(total_mps_over_time_data,t.year)-1)].total_mps,t.women_pct=t.total_women_mps/t.total_mps*100}),window.info_bubbles_data=o,draw_graph()}),d3.queue().defer(d3.csv,"mp_base64.csv",function(t){return{id:t.id,base64:t.base64}}).await(function(t,e){mp_base64_data={};for(var a=0;a<e.length;a++)mp_base64_data[e[a].id]=e[a].base64}),d3.queue().defer(d3.csv,"women_in_govt.csv",function(t){return{year:d3.timeParse("%Y-%m-%d")(t.date),women_pct:+t.women_parliament,country:t.country}}).defer(d3.json,"speech_samples.json").defer(d3.csv,"baked_positions.csv?"+Math.floor(1e3*Math.random())).defer(d3.csv,"mp_topic_fraction.csv?"+Math.floor(1e3*Math.random())).defer(d3.csv,"topic_medians.csv?"+Math.floor(100*Math.random()),function(t){return{topic:t.topic,male:Math.pow(10,+t.male),female:Math.pow(10,+t.female)}}).await(function(t,e,a,i,o,n){women_in_govt_data=d3.nest().key(t=>t.country).entries(e),speech_samples_data=d3.nest().key(t=>t.mp_name).entries(a),topic_medians_data={},baked_positions_data=[];var r=[];n.forEach(t=>{topic_medians_data[t.topic]={male:t.male,female:t.female}}),i.forEach(function(t){Object.keys(t).forEach(function(e){if("id"!=e&&"y"!=e.slice(-1)){var a=e.slice(0,-2);baked_positions_data.push({id:+t.id,topic:a,x:+t[a+"_x"],y:+t[a+"_y"]})}})}),baked_positions_data=d3.nest().key(t=>t.topic).entries(baked_positions_data),r=o.map(function(t){var e={id:+t.id,full_name:t.full_name,party:t.Party,gender:1==t.is_female?"Female":"Male"};return Object.keys(t).forEach(function(a){"id"!=a&"full_name"!=a&"Party"!=a&"is_female"!=a&&(e[a]="-inf"==t[a]?0:Math.pow(10,+t[a]))}),e}),nodes_male=r.filter(t=>"Male"==t.gender),nodes_female=r.filter(t=>"Male"!=t.gender)})}function getRetinaRatio(){var t=window.devicePixelRatio||1,e=document.createElement("canvas").getContext("2d");return t/[e.webkitBackingStorePixelRatio,e.mozBackingStorePixelRatio,e.msBackingStorePixelRatio,e.oBackingStorePixelRatio,e.backingStorePixelRatio,1].reduce(function(t,e){return t||e})}function handleContainerEnter(t){$graphic.classed("is-fixed",!0),$graphic.classed("is-bottom",!1)}function handleContainerExit(t){$graphic.classed("is-fixed",!1),$graphic.classed("is-bottom","down"===t.direction),"down"==t.direction&&lastTransitioned>=4&&(new_slide=5,update_state())}function mpZoom(t,e="mid",a=3,i=0,o=0){let n=mps_over_time_data.filter(e=>e.clean_name==t)[0];mouseover_svg.transition().duration(1e3).call(zoom.transform,d3.zoomIdentity.translate(width/2+o,height/2+i).scale(a).translate(-("mid"==e?(x(n.term_start)+x(n.term_end))/2:x(n.term_end)),-y(n.stream))).on("end",()=>{d3.selectAll(".y-axis .tick").style("opacity",t=>t>=0?1:0)}),d3.select(tooltip).style("opacity",0),IGNORE_STATE=!0,mouseover_svg.select("line").datum(n).attr("x1",t=>x(t.term_start)).attr("x2",t=>x(t.term_end)-1.2*lineThickness).attr("y1",t=>y(t.stream)).attr("y2",t=>y(t.stream)).style("stroke-width",lineThickness).transition().delay(500).style("opacity",1)}function handleStepEnter(t){$step.classed("is-active",function(e,a){return a===t.index}),new_slide=+$step.nodes()[t.index].getAttribute("data-slide"),update_state();let e=+$step.nodes()[t.index].getAttribute("data-step");try{if(e==+$step.nodes()[t.index+("down"==t.direction?-1:1)].getAttribute("data-step"))return}catch(t){}switch(current_slide){case 0:switch(e){case 0:electionRects.transition().delay((t,e)=>50*e).style("opacity",.15);break;case.1:electionRects.filter((t,e)=>22==e).classed("hover",!0);break;case.2:dataContainer.selectAll("custom.line").filter(t=>"margaretbeckett"==t.clean_name).transition().duration(1e3).attr("y1",t=>y(t.stream)).attr("y2",t=>y(t.stream)).transition().duration(1e3).attr("x2",t=>x(t.term_end)-1.2*lineThickness).on("end",()=>{show_mp_tooltip(mps_over_time_data.filter(t=>"margaretbeckett"==t.clean_name)[1])});a=d3.timer(t=>{draw(context,!1),t>2e3&&(a.stop(),draw(context),draw(context_hidden,!0))});break;case.3:dataContainer.selectAll("custom.line").transition().delay((t,e)=>500+2*e).duration(1e3).attr("y1",t=>y(t.stream)).attr("y2",t=>y(t.stream)).transition().delay((t,e)=>200+2*e).duration(1e3).attr("x2",t=>x(t.term_end)-1.2*lineThickness);a=d3.timer(t=>{draw(context,!1),t>5e3&&(a.stop(),draw(context),draw(context_hidden,!0))});break;case.4:mouseover_svg.transition().duration(1e3).call(zoom.transform,d3.zoomIdentity),canvas.style("pointer-events","all");break;case 1:mpZoom("constancemarkievicz",focus="mid",scale_level=10,vshift=0,hshift=width/4),canvas.style("pointer-events","none");break;case 2:mpZoom("nancyastor"),canvas.style("pointer-events","none");break;case 3:mpZoom("nancyastor",focus="end",scale_level=5,vshift=height/4,hshift=width/4),canvas.style("pointer-events","none");break;case 4:mpZoom("margaretthatcher"),canvas.style("pointer-events","none");break;case 5:if(canvas.style("pointer-events","all"),electionRects.filter((t,e)=>22==e).classed("hover",!0),mp_filter=mps_over_time_data.filter(t=>t.term_start>=new Date(1997,4,1)&t.term_start<=new Date(1997,6,1)&"Lab"==t.party).map(t=>t.clean_name),"down"==t.direction){mouseover_svg.select("line").style("opacity",0);let t=mps_over_time_data.filter(t=>"louiseellman"==t.clean_name)[0];transform=d3.zoomIdentity.translate(3*width/4,3*height/5).scale(1.5).translate(-(x(t.term_start)+x(t.term_end))/2,-y(t.stream)),mouseover_svg.transition().duration(1e3).call(zoom.transform,d3.zoomIdentity).on("end",()=>{d3.selectAll(".y-axis .tick").style("opacity",t=>t>=0?1:0)}).transition().delay(500).call(zoom.transform,transform)}dataContainer.selectAll("custom.line").transition().delay("down"==t.direction?1e3:0).duration(500).attr("strokeStyle",t=>t.term_start>=new Date(1997,4,1)&t.term_start<=new Date(1997,6,1)&"Lab"==t.party?colorParty(t.party):hexToRGBA(colorParty(t.party),.2)),"up"==t.direction&&(context.save(),context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),context.translate(transform.x,transform.y),context.scale(transform.k,transform.k));a=d3.timer(e=>{draw(context,!1),e>500&&(a.stop(),draw(context),"up"==t.direction&&context.restore())},"down"==t.direction?1e3:0);break;case 6:mp_filter=["annebegg","judymallaber","sandraosborne","angelaesmith","giselastuart","annkeen","janetdean","chrismccafferty","juliemorgan","shonamcisaac","kalimountford","bettywilliams","lauramoffatt","lizblackman","mscandyatherton","dianaorgan","anncryer","gillianmerron","mariaeagle","louiseellman","margaretmoran","phyllisstarkey","geraldinesmith","sallykeeble","helenbrinton","lindagilroy","jackielawrence","jacquismith","karenbuck","fionamactaggart","annemcguire","daritaylor","debrashipley","melaniejohnson","jennyjones"],dataContainer.selectAll("custom.line").transition().duration(500).attr("strokeStyle",t=>t.term_start>=new Date(1997,4,1)&t.term_start<=new Date(1997,6,1)&"Lab"==t.party&-1!=mp_filter.indexOf(t.clean_name)?colorParty(t.party):hexToRGBA(colorParty(t.party),.2)),"down"==t.direction&&(context.save(),context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),context.translate(transform.x,transform.y),context.scale(transform.k,transform.k));var a=d3.timer(t=>{draw(context,!1),t>500&&(a.stop(),draw(context),context.restore())})}break;case 3:switch(e){case 2:d3.select("#slide4").style("pointer-events","all").style("opacity",1)}}}function handleStepExit(t){d3.select("#tooltip").style("opacity",0);let e=+$step.nodes()[t.index].getAttribute("data-step");try{if(e==+$step.nodes()[t.index+("down"==t.direction?1:-1)].getAttribute("data-step"))return}catch(t){}switch(current_slide){case 0:switch(e){case.1:electionRects.filter((t,e)=>22==e).classed("hover",!1);break;case.2:d3.select("#tooltip").style("opacity",0);break;case 5:if("up"==t.direction){electionRects.filter((t,e)=>22==e).classed("hover",!1),dataContainer.selectAll("custom.line").transition().attr("strokeStyle",t=>colorParty(t.party)),transform=d3.zoomIdentity,context.save(),context.clearRect(0,0,width+margin.left+margin.right,height+margin.bottom+margin.top),context.translate(transform.x,transform.y),context.scale(transform.k,transform.k);var a=d3.timer(t=>{draw(context,!1),t>500&&(a.stop(),draw(context),context.restore())})}break;case 6:"down"==t.direction&&(electionRects.filter((t,e)=>22==e).classed("hover",!1),mouseover_svg.transition().duration(1e3).call(zoom.transform,d3.zoomIdentity).on("end",()=>{d3.selectAll(".y-axis .tick").style("opacity",t=>t>=0?1:0),mp_filter=mps_over_time_data.map(t=>t.clean_name),dataContainer.selectAll("custom.line").transition().attr("strokeStyle",t=>colorParty(t.party));var t=d3.timer(e=>{draw(context,!1),e>500&&(t.stop(),draw(context))})}))}break;case 3:switch(e){case 2:"up"==t.direction&&d3.select("#slide4").style("pointer-events","none").style("opacity",0);break;case 3:"down"==t.direction&&d3.select("#slide4").style("pointer-events","none").style("opacity",0)}}}function draw_graph(){"use strict";var t=timeline.clientWidth-margin.left-margin.right,e=timeline.clientHeight-margin.top-margin.bottom;t!=width|e!=height&&(width=t,circleRadius=(lineThickness=.0018*(height=e)*2)/2,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mouseover_svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),ratio=getRetinaRatio(),context.scale(ratio,ratio),context.translate(margin.left,margin.top),canvas.attr("width",ratio*(width+margin.left+margin.right)).attr("height",ratio*(height+margin.top+margin.bottom)).style("width",width+margin.left+margin.right).style("height",height+margin.top+margin.bottom),context_hidden.scale(ratio,ratio),context_hidden.translate(margin.left,margin.top),canvas_hidden.attr("width",ratio*(width+margin.left+margin.right)).attr("height",ratio*(height+margin.top+margin.bottom)).style("width",width+margin.left+margin.right).style("height",height+margin.top+margin.bottom),new_slide=0,current_slide=-1,initial_render(),first_slide(),scroller.setup({container:"#scroll",graphic:".scroll__graphic",text:".scroll__text",step:".scroll__text .step",offset:.5,debug:!1}).onStepEnter(handleStepEnter).onStepExit(handleStepExit).onContainerEnter(handleContainerEnter).onContainerExit(handleContainerExit),d3.selectAll(".sticky").each(function(){Stickyfill.add(this)}),$step.style("margin-bottom",height),d3.select("#footer").style("margin-top",1.1*(height+margin.top+margin.bottom)))}var margin={top:30,right:50,bottom:60,left:100},colors={Lab:"#C61148",Labour:"#C61148",Con:"#0096DB",Conservative:"#0096DB",SNP:"#FCCA46","Scottish National Party":"#FCCA46","Lib Dem":"#F37A48","Liberal Democrat":"#F37A48",LD:"#F37A48",Green:"#A1C181",SF:"#008e4b",Other:"#50514F",Hover:"#e5e5e5",Active:"#A1C181"},new_slide=0,current_slide=-1,lastTransitioned=-1,scroller=scrollama();window.onbeforeunload=function(){window.scrollTo(0,0)};var ratio,clippedArea,electionRects,zoom,wrapper,transform,zoomedArea,pointsGroup,slide2Group,slide3Group,slide6Group,max_mps_line,max_mps_path,max_mps_area,max_mps_path_area,half_max_mps_line,half_max_mps_path,total_women_mps_line,total_women_mps_path,total_women_mps_area,total_women_mps_path_area,half_max_mps_line_smooth,text_path_50_50,women_in_govt_paths,mask,instance,x,y,xAxis,gX,xLabel,yAxis,gY,yLabel,tooltip,lineThickness,circleRadius,selected_mp,topic_bar_width,topic_bar_height,topicBarScale,topicColorScale,selected_topic,circle_male,circle_female,slide5_xScale,slide5_yScale,quadtree,mp_filter,mps_over_time_data,number_women_over_time_data,total_mps_over_time_data,women_in_govt_data,mp_base64_data,speech_samples_data,topic_medians_data,baked_positions_data,nodes_male,nodes_female,tracker_data=[{section:"1"},{section:"2"},{section:"3"},{section:"4"},{section:"5"},{section:"6"}],timeline=document.getElementById("timeline"),svg=d3.select(timeline).append("svg"),canvas=d3.select(timeline).append("canvas").attr("id","visible-canvas"),context=canvas.node().getContext("2d"),mouseover_svg=d3.select(timeline).append("svg").attr("id","mouseover-svg"),canvas_hidden=d3.select(document.createElement("canvas")),context_hidden=canvas_hidden.node().getContext("2d"),detachedContainer=document.createElement("custom"),dataContainer=d3.select(detachedContainer),width=0,height=0,partyHasLogo=Object.keys(colors),colourToNode={},initial_slide5=!0,IGNORE_STATE=!1,nextCol=1;d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)})},download_data();var $container=d3.select("#scroll"),$graphic=$container.select(".scroll__graphic"),$chart=$graphic.select(".chart"),$text=$container.select(".scroll__text"),$step=$text.selectAll(".step");window.addEventListener("resize",draw_graph);