function colorParty(t){"use strict";return void 0!==colors[t]?colors[t]:colors.Other}function formatDate(t){"use strict";var e=t.getMonth(),a=t.getFullYear();return["Jan","Feb","March","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][e]+" "+a}function reset_zoom(t){"use strict";svg.transition().duration(500).call(zoom.transform,d3.zoomIdentity).on("end",()=>{zoomedArea.attr("transform",null),zoom.on("zoom",null),svg.on("wheel.zoom",null).on("wheel.zoom",null).on("mousedown.zoom",null).on("dblclick.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom touchcancel.zoom",null),yAxis=d3.axisLeft(y),gY=d3.select(".y-axis").call(yAxis),t()})}function update_state(){"use strict";current_slide!=new_slide&&(0==current_slide&1==new_slide?reset_zoom(to_second_slide):-1!=current_slide&0==new_slide&&(zoom.on("zoom",zoomed),svg.call(zoom),to_first_slide()),current_slide=new_slide),d3.selectAll(".arc").classed("c-1",function(t){return t.index%2==0}).classed("c-2",function(t){return t.index%2==1}).classed("active",function(t){return t.index==current_slide})}function initialise_tracker(){"use strict";d3.select(".tracker").remove();var t=d3.select("body").append("div").attr("class","tracker");t.append("button").attr("type","button").attr("class","nav-prev").text("Prev").on("click",function(){new_slide=Math.max(0,current_slide-1),update_state()});var e=t.append("svg").append("g").attr("class","tracker-wrapper").attr("transform","translate(30,30)");t.append("button").attr("type","button").attr("class","nav-next").text("Next").on("click",function(){new_slide=Math.min(tracker_data.length-1,current_slide+1),update_state()});var a=d3.pie().value(1),n=d3.arc().outerRadius(30).innerRadius(0),r=d3.arc().outerRadius(30).innerRadius(0),o=e.selectAll(".arc").data(a(tracker_data)).enter().append("g").attr("class","arc");o.append("path").attr("d",n),o.append("text").attr("transform",function(t){return"translate("+r.centroid(t)+")"}).text(function(t){return t.data.section}),o.on("mouseover",function(){d3.select(this).classed("hover",!0)}).on("mouseout",function(){d3.select(this).classed("hover",!1),update_state()}).on("click",function(t){new_slide=t.index,update_state()}),update_state();var i=Math.sqrt(3),s="m"+[[0,-1],[i/2,.5],[0,1],[-i/2,.5],[-i/2,-.5],[0,-1],[i/2,-.5]].map(function(t){return[30*t[0],30*t[1]].join(",")}).join("l")+"z";e.append("path").attr("class","tracker-hexagon").attr("d",s),e.append("clipPath").attr("id","hex-mask").append("path").attr("fill","none").attr("d",s),d3.select(".tracker-wrapper").attr("clip-path","url(#hex-mask)")}function initial_render(){"use strict";x=d3.scaleTime().domain([new Date(1915,1,1),new Date(2020,1,1)]).range([0,width]),y=d3.scaleLinear().domain([0,200]).range([height,0]),svg.append("defs");var t=svg.append("g").attr("class","timeline-wrapper").attr("transform","translate("+margin.left+","+margin.top+")");initialise_tracker(),d3.select("#tooltip").remove(),d3.select("#timeline").append("div").attr("id","tooltip"),tooltip=document.getElementById("tooltip"),t.append("rect").style("opacity",0).attr("width",width).attr("height",height),clippedArea=t.append("g").attr("id","clippedArea").attr("clip-path","url(#clip)"),zoomedArea=clippedArea.append("g").attr("id","zoomed-area"),t.append("clipPath").attr("id","clip").append("rect").attr("width",width).attr("height",height),xAxis=d3.axisBottom(x),gX=t.append("g").attr("class","x-axis").attr("transform","translate(0,"+height+")").call(xAxis),yAxis=d3.axisLeft(y),gY=t.append("g").attr("class","y-axis").call(yAxis),t.append("text").attr("x",width/2).attr("y",0-margin.top/2).attr("text-anchor","middle").attr("class","chart-title").text("Women MPs in the House of Commons"),t.append("text").attr("x",width/2).attr("y",height+margin.bottom/2).attr("class","x-label").text("Time"),t.append("text").attr("transform","rotate(-90)").attr("y",0-margin.left/2).attr("x",0-height/2).attr("class","y-label").text("Number of MPs"),zoom=d3.zoom().scaleExtent([.95,40]).on("zoom",zoomed),svg.call(zoom)}function zoomed(){"use strict";zoomedArea.attr("transform",d3.event.transform),gX.call(xAxis.scale(d3.event.transform.rescaleX(x))),gY.call(yAxis.scale(d3.event.transform.rescaleY(y)))}function first_slide(){"use strict";function t(t){if(0==partyToggled||t.party==partyToggled){d3.select(this).moveToFront(),d3.select("#tooltip").style("opacity",1);var e=-1!=partyHasLogo.indexOf(t.party);tooltip.innerHTML=`\n                    <h1 style="background-color: ${colorParty(t.party)};">${t.name}</h1>\n                    <div class="mp-image-parent">\n                    ${void 0===mp_base64_data[t.id]?"":'<img class="mp-image-blurred" src="data:image/jpeg;base64,'+mp_base64_data[t.id]+'" /><img class="mp-image" src="./mp-images/mp-'+t.id+'.jpg" style="opacity: ${typeof d.loaded == \'undefined\' ? 0 : d.loaded;d.loaded = 1;};" onload="this.style.opacity = 1;" />'}\n                    </div>\n                    <div class="mp-term">${d3.timeFormat("%Y")(t.term_start)} &rarr;                     ${d3.timeFormat("%Y")(t.term_end)}</div>\n                    <div class="mp-party" style="opacity: ${e?0:1}">${t.party}</div>\n                    <div class="mp-constituency">${t.constituency}</div>\n                    ${e?`<img class="mp-party-logo" alt="${t.party} logo" style="opacity: ${e?1:0}" src="./party_logos/${t.party}.svg"/>`:""}\n                    `,pointsGroup.selectAll("g").style("opacity",function(e){return t.clean_name==e.clean_name?1:.6}).selectAll(".line-connect").style("stroke-width",function(e){return t.clean_name==e.clean_name?2*lineThickness:lineThickness})}d3.event.preventDefault()}d3.select("#slide1-group").remove(),d3.select("#election-rects").remove(),electionRects=zoomedArea.append("g").attr("id","election-rects").selectAll("rect").data(total_mps_over_time_data).enter().append("rect").attr("class","election-rect").classed("c-1",function(t,e){return e%2==0}).classed("c-2",function(t,e){return e%2==1}).attr("x",function(t){return x(t.year)}).attr("y",y(800)).attr("width",function(t,e){var a=t.year,n=total_mps_over_time_data[Math.min(total_mps_over_time_data.length-1,e+1)].year;return x(n)-x(a)}).attr("height",y(0)-y(2e3)),pointsGroup=zoomedArea.append("g").attr("id","slide1-group"),(instance=pointsGroup.selectAll("g").data(mps_over_time_data).enter().append("g")).append("line").attr("class","line-connect").style("stroke-width",lineThickness).style("stroke-linecap","round"),instance.append("rect").attr("class","hover-rect").style("opacity",0),instance.selectAll(".line-connect").attr("x1",function(t){return x(t.term_start)}).attr("x2",function(t){return x(t.term_end)-1.2*lineThickness}).attr("y1",function(t){return y(t.stream)}).attr("y2",function(t){return y(t.stream)}).attr("stroke",function(t){return colorParty(t.party)}),instance.selectAll(".hover-rect").attr("x",function(t){return x(t.term_start)-circleRadius/2}).attr("y",function(t){return y(t.stream)-(y(1)-y(2))/2}).attr("width",function(t){return x(t.term_end)-x(t.term_start)+circleRadius}).attr("height",y(1)-y(2)),instance.on("mouseover",t).on("mouseout",function(){pointsGroup.selectAll("g").style("opacity",function(t){return 0!=partyToggled?t.party==partyToggled?1:.1:1}),pointsGroup.selectAll(".line-connect").style("stroke-width",lineThickness)}).on("touchend",t).on("mousedown",function(t){partyToggled=0==partyToggled&&t.party,pointsGroup.selectAll("g").style("opacity",function(e){return t.party==e.party?1:0==partyToggled?1:.1}).moveToFront(),d3.event.preventDefault()}),instance.exit().remove(),current_slide=0}function to_first_slide(){lastTransitioned<0&&(lastTransitioned=0);var t=svg.transition().duration(1e3);t.select("#slide2-group").style("opacity",0).remove(),t.select("#info-bubbles").style("opacity",0).remove(),d3.select("#tooltip").style("opacity",0),d3.selectAll(".election-rect").on("mouseover",null).on("mouseout",null),y.domain([0,200]),t.select(".y-axis").call(yAxis),first_slide(),pointsGroup.style("opacity",0),t.select("#slide1-group").style("opacity",1)}function to_second_slide(){"use strict";lastTransitioned<1?(second_slide(!1),lastTransitioned=1):(d3.select("#slide1-group").style("opacity",1).transition().duration(1e3).style("opacity",0).remove(),second_slide(!0))}function second_slide(t=!1){pointsGroup.selectAll("g").style("opacity",1),d3.select("#slide2-group").remove(),slide2Group=zoomedArea.append("g").attr("id","slide2-group"),t&&slide2Group.style("opacity",0).transition().duration(1e3).style("opacity",1);var e=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.total_mps)}).curve(d3.curveCardinal),a=slide2Group.append("path").attr("class","max-mps-path slide2").datum(total_mps_over_time_data).attr("stroke-width",1.5*lineThickness).attr("d",e),n=d3.area().curve(d3.curveCardinal).x(function(t){return x(t.year)}).y0(height).y1(function(t){return y(t.total_mps)}),r=slide2Group.append("path").attr("class","max-mps-area slide2").data([total_mps_over_time_data]).attr("d",n).style("opacity",0),o=slide2Group.append("clipPath").attr("id","slide2-hover-mask").append("path").data([total_mps_over_time_data]).attr("d",n);d3.select("#election-rects").attr("clip-path","url(#slide2-hover-mask)").moveToFront();var i=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.total_mps/2)}).curve(d3.curveBasis),s=slide2Group.append("path").attr("class","half-max-mps-path slide2").datum(total_mps_over_time_data).attr("stroke-width",1.5*lineThickness).attr("d",i),l=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.total_women_mps)}).curve(d3.curveBasis),d=slide2Group.append("path").attr("class","total-women-mps-path slide2").datum(number_women_over_time_data).attr("fill","none").attr("stroke-width",1.5*lineThickness).attr("d",l).attr("stroke-dasharray",function(){return this.getTotalLength()}).attr("stroke-dashoffset",function(){return this.getTotalLength()}),c=d3.area().curve(d3.curveBasis).x(function(t){return x(t.year)}).y0(height).y1(function(t){return y(t.total_women_mps)}),p=slide2Group.append("path").attr("class","total-women-mps-area slide2").data([number_women_over_time_data]).attr("d",c).style("opacity",0);d3.select("#tooltip").style("opacity",0);var u=d3.bisector(function(t){return t.year}).left;pointsGroup.selectAll(".line-connect").transition().delay(t?500:0).duration(t?0:500).attr("x2",function(t){return x(t.term_start)}),pointsGroup.selectAll(".line-connect").transition().delay(500).duration(t?0:500).attr("y1",function(t){return y(number_women_over_time_data[u(number_women_over_time_data,t.term_start)].total_women_mps)}).attr("y2",function(t){return y(number_women_over_time_data[u(number_women_over_time_data,t.term_start)].total_women_mps)}).transition().delay(t?0:2e3).duration(t?0:250).style("opacity",0),d.transition().delay(t?0:1e3).ease(d3.easeCubic).duration(t?0:3e3).attr("stroke-dashoffset",0),y.domain([0,750]),gY.transition().delay(t?0:4e3).duration(t?1e3:750).call(yAxis),d.transition().delay(t?0:4e3).duration(t?0:750).attr("d",l),p.transition().delay(t?0:4e3).duration(t?0:750).attr("d",c).style("opacity",1),a.transition().delay(t?0:4e3).duration(t?0:750).attr("d",e),r.transition().delay(t?0:4e3).duration(t?0:750).attr("d",n).style("opacity",1),o.transition().delay(t?0:4e3).duration(t?0:750).attr("d",n),s.transition().delay(t?0:4e3).duration(t?0:750).attr("d",i),instance.on("mouseover",null).on("mouseout",null).on("click",null),svg.transition().delay(t?0:4500).on("end",()=>{slide2Group.append("text").attr("x",x(new Date(2010,1,1))).attr("y",y(0)-10*lineThickness).attr("font-size",Math.min(y(number_women_over_time_data.slice(-1)[0].total_women_mps)/4,(x(new Date(2020,1,1))-x(new Date(2e3,1,1)))/4)).attr("class","women-label").text("Women").style("opacity",0).transition().duration(t?0:500).style("opacity",1),slide2Group.append("text").attr("x",x(new Date(2010,1,1))).attr("y",y(500)).attr("font-size",Math.min(y(number_women_over_time_data.slice(-1)[0].total_women_mps)/4,(x(new Date(2020,1,1))-x(new Date(2e3,1,1)))/4)).attr("class","men-label").text("Men").style("opacity",0).transition().duration(t?0:500).style("opacity",1);var e=d3.line().x(function(t){return x(t.year)}).y(function(t){return y(t.total_mps/2)}).curve(d3.curveBundle.beta(.75));slide2Group.append("defs").append("path").attr("id","half-max-textpath").datum(total_mps_over_time_data).attr("d",e),slide2Group.append("text").append("textPath").attr("startOffset","75%").attr("xlink:href","#half-max-textpath").attr("font-size",Math.max(10*lineThickness,Math.min(20*lineThickness,(x(new Date(2020,1,1))-x(new Date(2e3,1,1)))/6))).attr("class","i5050-label").text("50:50 gender representation").style("opacity",0).transition().duration(t?0:500).style("opacity",1),electionRects.on("mouseover",function(t,e){d3.select("#tooltip").style("opacity",1),d3.select(this).classed("hover",!0);var a=t.year,n=total_mps_over_time_data[Math.min(total_mps_over_time_data.length-1,e+1)].year,r=number_women_over_time_data[u(number_women_over_time_data,a)].total_women_mps,o=t.total_mps/r-1;tooltip.innerHTML=`<div class="slide2-tooltip"><h1>${formatDate(a)} &rarr; ${formatDate(n)}</h1>\n            ${r>0?`For every <span class="female">female</span> MP, there ${new Date>n?"were":"are"}\n                                <div class="gender-ratio">${o.toFixed(1)}</div> <span class="male">male</span> MPs.`:"There were no women in the House of Commons yet :("}\n                                </div>\n            `}).on("mouseout",function(){d3.select(this).classed("hover",!1)});var a=d3.timeParse("%Y-%m-%d");d3.select("#info-bubbles").remove();var n=zoomedArea.append("g").attr("id","info-bubbles").selectAll("g").data(info_bubbles_data.slide2).enter().append("g"),r=d3.voronoi().x(function(t){return x(d3.timeParse("%Y-%m-%d")(t.x))}).y(function(t){return y(t.y)}).extent([[-margin.left,-margin.top],[width+margin.right,height+margin.bottom]]);d3.select("#info-bubbles").append("defs").selectAll("clipPath").data(r.polygons(info_bubbles_data.slide2)).enter().append("clipPath").attr("id",function(t,e){return`voronoi-clip-${e}`}).append("path").attr("d",function(t){return t?"M"+t.join("L")+"Z":null}),n.append("circle").attr("r",50*circleRadius).attr("class","info-bubble-hidden").style("opacity",0).attr("cx",function(t){return x(a(t.x))}).attr("cy",function(t){return y(t.y)}).style("clip-path",function(t,e){return`url(#voronoi-clip-${e})`}).attr("clip-path",function(t,e){return`url(#voronoi-clip-${e})`}),n.append("circle").attr("r",0).attr("class","info-bubble").attr("stroke-width",2*circleRadius).attr("cx",function(t){return x(a(t.x))}).attr("cy",function(t){return y(t.y)}).transition().delay(t?0:function(t,e){return 1e3+250*e}).duration(t?0:1e3).ease(d3.easeBounce).attr("r",5*circleRadius),n.on("mouseover",function(t){d3.select(this).moveToFront(),d3.select(this).select(".info-bubble").classed("hover",!0).transition().duration(500).ease(d3.easeBounce).attr("r",10*circleRadius),d3.select("#tooltip").style("opacity",1),tooltip.innerHTML=`\n                            <div class="info-bubble-tip">\n                                <h1>${t.head}</h1>\n                                <div class="date">${formatDate(a(t.x))}</div>\n                                <div class="body">${t.body}</div>\n                            </div>`}).on("mouseout",function(){d3.select(this).select(".info-bubble").classed("hover",!1).transition().duration(500).ease(d3.easeBounce).attr("r",5*circleRadius)})})}function draw_graph(){"use strict";d3.selectAll("g").remove();var t=timeline.clientWidth-margin.left-margin.right,e=timeline.clientHeight-margin.top-margin.bottom;t!=width|e!=height&&(width=t,circleRadius=(lineThickness=.0018*(height=e)*2)/2,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),d3.queue().defer(d3.csv,"women_mps.csv",function(t){var e=d3.timeParse("%Y-%m-%d");return{id:t.id,name:t.name,constituency:t.constituency,term_start:e(t.term_start),term_end:e(t.term_end),party:t.party,byelection:"TRUE"==t.byelection,notes:t.notes,clean_name:t.clean_name,stream:+t.stream}}).defer(d3.csv,"number_women_over_time.csv",function(t){return{year:d3.timeParse("%Y-%m-%d")(t.Year),total_women_mps:+t.Total,total_mps:+t.total_mps}}).defer(d3.csv,"total_mps_over_time.csv",function(t){return{year:d3.timeParse("%Y-%m-%d")(t.Year),total_mps:+t.total_mps}}).defer(d3.json,"info_bubbles.json").await(analyze),d3.queue().defer(d3.csv,"mp_base64.csv",function(t){return{id:t.id,base64:t.base64}}).await(function(t,e){mp_base64_data={};for(var a=0;a<e.length;a++)mp_base64_data[e[a].id]=e[a].base64}))}function analyze(t,e,a,n,r){mps_over_time_data=e,number_women_over_time_data=a,total_mps_over_time_data=n,info_bubbles_data=r,new_slide=0,current_slide=-1,initial_render(),first_slide()}var clippedArea,electionRects,zoom,zoomedArea,pointsGroup,slide2Group,instance,x,y,xAxis,gX,yAxis,gY,tooltip,lineThickness,circleRadius,mps_over_time_data,number_women_over_time_data,total_mps_over_time_data,mp_base64_data,info_bubbles_data,margin={top:60,right:50,bottom:60,left:100},colors={Lab:"#C61148",Con:"#0096DB",SNP:"#FCCA46","Lib Dem":"#F37A48",LD:"#F37A48",Green:"#A1C181",SF:"#008e4b",Other:"#50514F",Hover:"#e5e5e5",Active:"#A1C181"},new_slide=0,current_slide=-1,partyToggled=!1,lastTransitioned=-1,tracker_data=[{section:"1"},{section:"2"},{section:"3"},{section:"4"},{section:"5"},{section:"6"}],timeline=document.getElementById("timeline"),svg=d3.select(timeline).append("svg"),width=0,height=0,partyHasLogo=Object.keys(colors);d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)})},draw_graph(),window.addEventListener("resize",draw_graph);